<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki">
<meta name="theme-color" content="#008800">
<meta name="robots" content="index,follow">
<meta name="keywords" content="v5,userguide,active_record">
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.html" title="ADOdb">
<link rel="start" href="active_record.html">
<link rel="contents" href="active_record.html" title="Sitemap">
<link rel="manifest" href="../../lib/exe/manifest.html">
<link rel="alternate" type="application/rss+xml" title="Recent Changes">
<link rel="alternate" type="application/rss+xml" title="Current namespace">
<link rel="alternate" type="text/html" title="Plain HTML" href="active_record.html">
<link rel="alternate" type="text/plain" title="Wiki Markup" href="active_record.html">
<link rel="canonical" href="https://adodb.org/dokuwiki/doku.php?id=v5:userguide:active_record">
<link rel="stylesheet" href="../../lib/exe/css.php.t.dokuwiki.css">
<!--[if gte IE 9]><!-->
<script>/*<![CDATA[*/var NS='v5:userguide';var JSINFO = {"plugins":{"edittable":{"default columnwidth":""}},"move_renameokay":false,"id":"v5:userguide:active_record","namespace":"v5:userguide","ACT":"show","useHeadingNavigation":1,"useHeadingContent":1};
/*!]]>*/</script>
<script src="../../lib/exe/jquery.php.t.dokuwiki.js" defer>/*<![CDATA[*/
/*!]]>*/</script>
<script src="../../lib/exe/js.php.t.dokuwiki.js" defer>/*<![CDATA[*/
/*!]]>*/</script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="shortcut icon" href="../../lib/tpl/dokuwiki/images/favicon.ico">
<link rel="apple-touch-icon" href="../../lib/tpl/dokuwiki/images/apple-touch-icon.png">
    <title>v5:userguide:active_record</title></head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki    showSidebar hasSidebar">

        
<!-- ********** HEADER ********** -->
<header id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1 class="logo"><a href="../..//index.html" accesskey="h" title="Home [h]"><img src="../../logo.png" width="176" height="62" alt=""> <span>ADOdb</span></a></h1>
                    <p class="claim">Database Abstraction Layer for PHP</p>
            </div>

    

    <!-- BREADCRUMBS -->
            
    
    <hr class="a11y">
<div style="text-align:right"><a href="https://adodb.org">ADOdb Web Site</a></div></div></header><!-- /header -->

        <div class="wrapper group">

                            <!-- ********** ASIDE ********** -->
                <nav id="dokuwiki__aside" aria-label="Sidebar"><div class="pad aside include group">
                    <h3 class="toggle">Sidebar</h3>
                    <div class="content"><div class="group">
                                                                        
<p>
<strong>Resources</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="../../v5/reference/reference_index.html" class="wikilink1" title="v5:reference:reference_index" data-wiki-id="v5:reference:reference_index">Reference Manual</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/userguide/userguide_index.html" class="wikilink1" title="v5:userguide:userguide_index" data-wiki-id="v5:userguide:userguide_index">User Guide &amp; Tutorials</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/dictionary/dictionary_index.html" class="wikilink1" title="v5:dictionary:dictionary_index" data-wiki-id="v5:dictionary:dictionary_index">The Data Dictionary</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/axmls/axmls_index.html" class="wikilink1" title="v5:axmls:axmls_index" data-wiki-id="v5:axmls:axmls_index">ADOdb-xmlschema</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/activerecord/activerecord_index.html" class="wikilink1" title="v5:activerecord:activerecord_index" data-wiki-id="v5:activerecord:activerecord_index">ADOdb Active Record</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/performance/performance_index.html" class="wikilink1" title="v5:performance:performance_index" data-wiki-id="v5:performance:performance_index">Performance Monitoring</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/datetime/datetime_index.html" class="wikilink1" title="v5:datetime:datetime_index" data-wiki-id="v5:datetime:datetime_index">Date/Time Library</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/session/session_index.html" class="wikilink1" title="v5:session:session_index" data-wiki-id="v5:session:session_index">Session Management Library</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/proxy/proxy_index.html" class="wikilink1" title="v5:proxy:proxy_index" data-wiki-id="v5:proxy:proxy_index">ADOdb Proxy Server</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/addons/addons_index.html" class="wikilink1" title="v5:addons:addons_index" data-wiki-id="v5:addons:addons_index">Unsupported Addons</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../project/standards.html" class="wikilink1" title="project:standards" data-wiki-id="project:standards">Coding Standards</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/php_compatibility_status.html" class="wikilink1" title="v5:php_compatibility_status" data-wiki-id="v5:php_compatibility_status">PHP Compatibility Status</a></div>
</li>
</ul>

<p>
<strong><a href="../../v5/database/supported.html" class="wikilink1" title="v5:database:supported" data-wiki-id="v5:database:supported">Supported Databases</a></strong>
</p>
<ol>
<li class="level1"><div class="li"> Full support    <ul><li><a href="../../v5/database/ibm_db2.html" class="wikilink1" title="v5:database:ibm_db2">IBM DB2</a></li><li><a href="../../v5/database/microsoft_sql_server.html" class="wikilink1" title="v5:database:microsoft_sql_server">Microsoft SQL Server</a></li><li><a href="../../v5/database/mysql.html" class="wikilink1" title="v5:database:mysql">MySQL</a></li><li><a href="../../v5/database/oracle.html" class="wikilink1" title="v5:database:oracle">Oracle</a></li><li><a href="../../v5/database/postgresql.html" class="wikilink1" title="v5:database:postgresql">PostgreSQL</a></li><li><a href="../../v5/database/sqlite.html" class="wikilink1" title="v5:database:sqlite">SQLite Database</a></li></ul></div>
</li>
<li class="level1"><div class="li"> Partial support <ul><li><a href="../../v5/database/firebird.html" class="wikilink1" title="v5:database:firebird">Firebird &amp; Interbase</a></li><li><a href="../../v5/database/ldap.html" class="wikilink1" title="v5:database:ldap">LDAP</a></li><li><a href="../../v5/database/access.html" class="wikilink1" title="v5:database:access">Microsoft Access</a></li><li><a href="../../v5/database/odbc.html" class="wikilink1" title="v5:database:odbc">ODBC</a></li><li><a href="../../v5/database/pdo.html" class="wikilink1" title="v5:database:pdo">PDO</a></li><li><a href="../../v5/database/pdo_new.html" class="wikilink1" title="v5:database:pdo_new">PDO (new)</a></li></ul></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/database/unsupported.html" class="wikilink1" title="v5:database:unsupported" data-wiki-id="v5:database:unsupported">Obsolete/Unsupported Drivers</a></div>
</li>
</ol>
                                            </div></div>
                </div></nav><!-- /aside -->
            
            <!-- ********** CONTENT ********** -->
            <main id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>v5:userguide:active_record</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#introduction">Introduction</a></div></li>
<li class="level1"><div class="li"><a href="#additional_functionality">Additional functionality</a></div></li>
<li class="level1"><div class="li"><a href="#setting_the_database_connection">Setting the Database Connection</a></div></li>
<li class="level1"><div class="li"><a href="#table_rows_as_objects">Table Rows as Objects</a></div></li>
<li class="level1"><div class="li"><a href="#table_columns_as_object_properties">Table Columns as Object Properties</a></div></li>
<li class="level1"><div class="li"><a href="#inserting_and_updating_a_record">Inserting and Updating a Record</a></div></li>
<li class="level1"><div class="li"><a href="#adodb_specific_functionality">ADOdb Specific Functionality</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#setting_the_table_name">Setting the Table Name</a></div></li>
<li class="level2"><div class="li"><a href="#adodb_assoc_case">ADODB_ASSOC_CASE</a></div></li>
<li class="level2"><div class="li"><a href="#adodb_active_recordsave">ADOdb_Active_Record::Save()</a></div></li>
<li class="level2"><div class="li"><a href="#adodb_active_recordreplace">ADOdb_Active_Record::Replace()</a></div></li>
<li class="level2"><div class="li"><a href="#adodb_active_recordfind_whereorderby_bindarr_false_pkeyarr_false">ADOdb_Active_Record::Find($whereOrderBy, $bindarr=false, $pkeyArr=false)</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#quoting_identifiers">Quoting Identifiers</a></div></li>
<li class="level1"><div class="li"><a href="#error_handling_and_debugging">Error Handling and Debugging</a></div></li>
<li class="level1"><div class="li"><a href="#primary_keys">Primary Keys</a></div></li>
<li class="level1"><div class="li"><a href="#retrieval_of_auto-incrementing_id">Retrieval of Auto-incrementing ID</a></div></li>
<li class="level1"><div class="li"><a href="#adodb_active_cachesecs">$ADODB_ACTIVE_CACHESECS</a></div></li>
<li class="level1"><div class="li"><a href="#active_record_considered_bad">Active Record Considered Bad?</a></div></li>
<li class="level1"><div class="li"><a href="#transactions">Transactions</a></div></li>
<li class="level1"><div class="li"><a href="#one_to_many_relations">One to Many Relations</a></div></li>
<li class="level1"><div class="li"><a href="#classhasmany">ClassHasMany</a></div></li>
<li class="level1"><div class="li"><a href="#tablehasmany">TableHasMany</a></div></li>
<li class="level1"><div class="li"><a href="#tablekeyhasmany">TableKeyHasMany</a></div></li>
<li class="level1"><div class="li"><a href="#classbelongsto">ClassBelongsTo</a></div></li>
<li class="level1"><div class="li"><a href="#tablebelongsto">TableBelongsTo</a></div></li>
<li class="level1"><div class="li"><a href="#tablekeybelongsto">TableKeyBelongsTo</a></div></li>
<li class="level1"><div class="li"><a href="#belongsto">BelongsTo</a></div></li>
<li class="level1"><div class="li"><a href="#loadrelations">LoadRelations</a></div></li>
<li class="level1"><div class="li"><a href="#acknowledgements">Acknowledgements</a></div></li>
<li class="level1"><div class="li"><a href="#adoconnection_supplement">ADOConnection Supplement</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#adoconnectiongetactiverecords">ADOConnection::GetActiveRecords()</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#activerecord_code_sample">ActiveRecord Code Sample</a></div></li>
<li class="level1"><div class="li"><a href="#active_record_extended">Active Record eXtended</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->
<div class="wrap_todo plugin_wrap">
<p>
Fix this
</p>
</div>
<h1 class="sectionedit3" id="adodb_active_record">ADOdb Active Record</h1>
<div class="level1">
<div class="wrap_right wrap_box wrap_round plugin_wrap">
<p>
Author Credit: John Lim
</p>
</div>
</div>

<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">

<p>
ADOdb_Active_Record is an Object Relation Mapping (ORM) implementation using PHP. In an ORM system, the tables and rows of the database are abstracted into native PHP objects. This allows the programmer to focus more on manipulating the data and less on writing SQL queries.
</p>

<p>
This implementation differs from Zend Framework's implementation in the following ways:
</p>
<ul>
<li class="level1"><div class="li"> Works with PHP4 and PHP5 and provides equivalent functionality in both versions of PHP.</div>
</li>
<li class="level1"><div class="li"> ADOdb_Active_Record works when you are connected to multiple databases. Zend's only works when connected to a default database.</div>
</li>
<li class="level1"><div class="li"> Support for <a href="../../v5/reference/adodb_assoc_case.html" class="wikilink1" title="v5:reference:adodb_assoc_case" data-wiki-id="v5:reference:adodb_assoc_case">ADODB_ASSOC_CASE</a>. The field names are upper-cased, lower-cased or left in natural case depending on this setting.</div>
</li>
<li class="level1"><div class="li"> No field name conversion to camel-caps style, unlike Zend's implementation which will convert field names such as 'first_name' to 'firstName'.</div>
</li>
<li class="level1"><div class="li"> NewADOConnection::GetActiveRecords() and ADOConnection::GetActiveRecordsClass() functions in adodb.inc.php.</div>
</li>
<li class="level1"><div class="li"> Caching of table metadata so it is only queried once per table, no matter how many Active Records are created.</div>
</li>
<li class="level1"><div class="li"> PHP5 version of ADOdb_Active_Record now supports one-to-many relationships.</div>
</li>
<li class="level1"><div class="li"> New adodb-active-recordx.inc.php, which is an Active Record eXtended implementation that support JOINs for higher performance when loading children, and other nice features.</div>
</li>
</ul>

</div>

<h2 class="sectionedit7" id="additional_functionality">Additional functionality</h2>
<div class="level2">

<p>
ADOdb_Active_Record is designed upon the principles of the &ldquo;ActiveRecord&rdquo; design pattern, which was first described by Martin Fowler. The ActiveRecord pattern has been implemented in many forms across the spectrum of programming languages. ADOdb_Active_Record attempts to represent the database as closely to native PHP objects as possible.
</p>

<p>
ADOdb_Active_Record maps a database table to a PHP class, and each instance of that class represents a table row. Relations between tables can also be defined, allowing the ADOdb_Active_Record objects to be nested.
</p>

</div>

<h2 class="sectionedit8" id="setting_the_database_connection">Setting the Database Connection</h2>
<div class="level2">

<p>
The first step to using ADOdb_Active_Record is to set the default connection that an ADOdb_Active_Record objects will use to connect to a database.
</p>
<pre class="code php"><span class="kw1">require_once</span><span class="br0">(</span><span class="st_h">'adodb/adodb-active-record.inc.php'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$db</span> <span class="sy0">=</span> NewADOConnection<span class="br0">(</span><span class="st_h">'mysql:/ /root:pwd@localhost/dbname'</span><span class="br0">)</span><span class="sy0">;</span>
ADOdb_Active_Record<span class="sy0">::</span><span class="me2">SetDatabaseAdapter</span><span class="br0">(</span><span class="re0">$db</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit9" id="table_rows_as_objects">Table Rows as Objects</h2>
<div class="level2">

<p>
First, let's create a temporary table in our MySQL database that we can use for demonstrative purposes throughout the rest of this tutorial. We can do this by sending a CREATE query:
</p>
<pre class="code php"><span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"CREATE TEMPORARY TABLE `persons` (
                `id` int(10) unsigned NOT NULL auto_increment,
                `name_first` varchar(100) NOT NULL default '',
                `name_last` varchar(100) NOT NULL default '',
                `favorite_color` varchar(100) NOT NULL default '',
                PRIMARY KEY  (`id`)
            ) ENGINE=MyISAM;
           "</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
ADOdb_Active_Records are object representations of table rows. Each table in the database is represented by a class in PHP. To begin working with a table as a ADOdb_Active_Record, a class that extends ADOdb_Active_Record needs to be created for it.
</p>
<pre class="code php"><span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span>
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
In the above example, a new ADOdb_Active_Record object $person was created to access the &ldquo;persons&rdquo; table. Zend_Db_DataObject takes the name of the class, pluralizes it (according to American English rules), and assumes that this is the name of the table in the database. Also note that with MySQL, table names are case-sensitive, so your class name must match the table name's case. With other databases with case-insensitive tables, your class can be capitalized differently.
</p>

<p>
This kind of behavior is typical of ADOdb_Active_Record. It will assume as much as possible by convention rather than explicit configuration. In situations where it isn't possible to use the conventions that ADOdb_Active_Record expects, options can be overridden as we'll see later.
</p>

</div>

<h2 class="sectionedit10" id="table_columns_as_object_properties">Table Columns as Object Properties</h2>
<div class="level2">

<p>
When the $person object was instantiated, ADOdb_Active_Record read the table metadata from the database itself, and then exposed the table's columns (fields) as object properties.
</p>

<p>
Our &ldquo;persons&rdquo; table has three fields: &ldquo;name_first&rdquo;, &ldquo;name_last&rdquo;, and &ldquo;favorite_color&rdquo;. Each of these fields is now a property of the $person object. To see all these properties, use the ADOdb_Active_Record::getAttributeNames() method:
</p>
<pre class="code php"><a target="_blank" href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">getAttributeNames</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co4">/**
 * Outputs the following:
 * array(4) {
 *    [0]=&gt;
 *    string(2) "id"
 *    [1]=&gt;
 *    string(9) "name_first"
 *    [2]=&gt;
 *    string(8) "name_last"
 *    [3]=&gt;
 *    string(13) "favorite_color"
 *  }
 */</span></pre>

<p>
One big difference between ADOdb and Zend's implementation is we do not automatically convert to camelCaps style.
</p>

</div>

<h2 class="sectionedit11" id="inserting_and_updating_a_record">Inserting and Updating a Record</h2>
<div class="level2">

<p>
An ADOdb_Active_Record object is a representation of a single table row. However, when our $person object is instantiated, it does not reference any particular row. It is a blank record that does not yet exist in the database. An ADOdb_Active_Record object is considered blank when its primary key is NULL. The primary key in our persons table is &ldquo;id&rdquo;.
</p>

<p>
To insert a new record into the database, change the object's properties and then call the ADOdb_Active_Record::save() method:
</p>
<pre class="code php"><span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_first</span> <span class="sy0">=</span> <span class="st_h">'Andi'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_last</span>  <span class="sy0">=</span> <span class="st_h">'Gutmans'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;</pre>

<p>
Oh, no! The above code snippet does not insert a new record into the database. Instead, outputs an error:
</p>

<p>
1048: Column 'favorite_color' cannot be null
</p>

<p>
This error occurred because MySQL rejected the INSERT query that was generated by ADOdb_Active_Record. If exceptions are enabled in ADOdb and you are using PHP5, an error will be thrown. In the definition of our table, we specified all of the fields as NOT NULL; i.e., they must contain a value.
</p>

<p>
ADOdb_Active_Records are bound by the same contraints as the database tables they represent. If the field in the database cannot be NULL, the corresponding property in the ADOdb_Active_Record also cannot be NULL. In the example above, we failed to set the property $person&rarr;favoriteColor, which caused the INSERT to be rejected by MySQL.
</p>

<p>
To insert a new ADOdb_Active_Record in the database, populate all of ADOdb_Active_Record's properties so that they satisfy the constraints of the database table, and then call the save() method:
</p>
<pre class="code php"><span class="co4">/**
 * Calling the save() method will successfully INSERT
 * this $person into the database table.
 */</span>
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_first</span>     <span class="sy0">=</span> <span class="st_h">'Andi'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_last</span>      <span class="sy0">=</span> <span class="st_h">'Gutmans'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">favorite_color</span> <span class="sy0">=</span> <span class="st_h">'blue'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
Once this $person has been INSERTed into the database by calling save(), the primary key can now be read as a property. Since this is the first row inserted into our temporary table, its &ldquo;id&rdquo; will be 1:
</p>
<pre class="code php"><a target="_blank" href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">id</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co4">/**
 * Outputs the following:
 * string(1)
 */</span>
&nbsp;</pre>

<p>
From this point on, updating it is simply a matter of changing the object's properties and calling the save() method again:
</p>
<pre class="code php"><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">favorite_color</span> <span class="sy0">=</span> <span class="st_h">'red'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
The code snippet above will change the favorite color to red, and then UPDATE the record in the database.
</p>

</div>

<h2 class="sectionedit12" id="adodb_specific_functionality">ADOdb Specific Functionality</h2>
<div class="level2">

</div>

<h3 class="sectionedit13" id="setting_the_table_name">Setting the Table Name</h3>
<div class="level3">

<p>
The default behaviour on creating an ADOdb_Active_Record is to &ldquo;pluralize&rdquo; the class name and use that as the table name. Often, this is not the case. For example, the person class could be reading from the &ldquo;People&rdquo; table.
</p>

<p>
We provide two ways to define your own table:
</p>
<ol>
<li class="level1"><div class="li"> Use a constructor parameter to override the default table naming behaviour. <pre class="code php"><span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record <span class="br0">{</span><span class="br0">}</span>
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="st_h">'People'</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> Define it in a class declaration: <pre class="code php"><span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record
<span class="br0">{</span>
    <span class="kw2">var</span> <span class="re0">$_table</span> <span class="sy0">=</span> <span class="st_h">'People'</span><span class="sy0">;</span>
<span class="br0">}</span>
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>
</li>
</ol>

</div>

<h3 class="sectionedit14" id="adodb_assoc_case">ADODB_ASSOC_CASE</h3>
<div class="level3">

<p>
This allows you to control the case of field names and properties. For example, in Oracle all field names are uppercase by default, so you can force them to lowercase using <code>define('ADODB_ASSOC_CASE', ADODB_ASSOC_CASE_LOWER);</code>.
</p>

<p>
For further details on valid values and usage, see <a href="../../v5/reference/adodb_assoc_case.html" class="wikilink1" title="v5:reference:adodb_assoc_case" data-wiki-id="v5:reference:adodb_assoc_case">ADODB_ASSOC_CASE</a> reference.
</p>
<pre class="code php"><span class="co1">// ADODB_ASSOC_CASE ==  ADODB_ASSOC_CASE_LOWER</span>
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="st_h">'People'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name</span> <span class="sy0">=</span> <span class="st_h">'Lily'</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// ADODB_ASSOC_CASE ==  ADODB_ASSOC_CASE_UPPER</span>
<span class="re0">$person2</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="st_h">'People'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person2</span><span class="sy0">-&gt;</span><span class="me1">NAME</span> <span class="sy0">=</span> <span class="st_h">'Lily'</span><span class="sy0">;</span></pre>

</div>

<h3 class="sectionedit15" id="adodb_active_recordsave">ADOdb_Active_Record::Save()</h3>
<div class="level3">

<p>
Saves a record by executing an INSERT or UPDATE SQL statement as appropriate.
</p>

<p>
Returns false on unsuccessful INSERT, true if successsful INSERT.
</p>

<p>
Returns 0 on failed UPDATE, and 1 on UPDATE if data has changed, and -1 if no data was changed, so no UPDATE statement was executed.
</p>

</div>

<h3 class="sectionedit16" id="adodb_active_recordreplace">ADOdb_Active_Record::Replace()</h3>
<div class="level3">

<p>
ADOdb supports replace functionality, whereby the record is inserted if it does not exists, or updated otherwise.
</p>
<pre class="code php"><span class="re0">$rec</span> <span class="sy0">=</span> <span class="kw2">new</span> ADOdb_Active_Record<span class="br0">(</span><span class="st0">"product"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">name</span> <span class="sy0">=</span> <span class="st_h">'John'</span><span class="sy0">;</span>
<span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">tel_no</span> <span class="sy0">=</span> <span class="st_h">'34111145'</span><span class="sy0">;</span>
<span class="re0">$ok</span> <span class="sy0">=</span> <span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">replace</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// 0=failure, 1=update, 2=insert</span>
ADOdb_Active_Record<span class="sy0">::</span><span class="me2">Load</span><span class="br0">(</span><span class="re0">$where</span><span class="br0">)</span></pre>

<p>
Sometimes, we want to load a single record into an Active Record. We can do so using:
</p>
<pre class="code php"><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">load</span><span class="br0">(</span><span class="st0">"id=3"</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// or using bind parameters</span>
&nbsp;
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">load</span><span class="br0">(</span><span class="st0">"id=?"</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="nu0">3</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
Returns <span class="kw4">false</span> <span class="kw1">if</span> an error occurs<span class="sy0">.</span></pre>

</div>

<h3 class="sectionedit17" id="adodb_active_recordfind_whereorderby_bindarr_false_pkeyarr_false">ADOdb_Active_Record::Find($whereOrderBy, $bindarr=false, $pkeyArr=false)</h3>
<div class="level3">

<p>
We want to retrieve an array of active records based on some search criteria. For example:
</p>
<pre class="code php"><span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record <span class="br0">{</span>
    <span class="kw2">var</span> <span class="re0">$_table</span> <span class="sy0">=</span> <span class="st_h">'people'</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$peopleArray</span> <span class="sy0">=</span> <span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st0">"name like ? order by age"</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'Sm%'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit18" id="quoting_identifiers">Quoting Identifiers</h2>
<div class="level2">

<p>
You can force column names to be quoted in INSERT and UPDATE statements, typically because you are using reserved words as column names by setting
</p>
<pre class="code">ADODB_Active_Record::$_quoteNames = true;</pre>

<p>
Default is false.
</p>

</div>

<h2 class="sectionedit19" id="error_handling_and_debugging">Error Handling and Debugging</h2>
<div class="level2">

<p>
In PHP5, if adodb-exceptions.inc.php is included, then errors are thrown. Otherwise errors are handled by returning a value. False by default means an error has occurred. You can get the last error message using the ErrorMsg() function.
</p>

<p>
To check for errors in ADOdb_Active_Record, do not poll ErrorMsg() as the last error message will always be returned, even if it occurred several operations ago. Do this instead:
</p>
<pre class="code php"><span class="co2"># right!
</span><span class="re0">$ok</span> <span class="sy0">=</span> <span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">Save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span><span class="re0">$ok</span><span class="br0">)</span> <span class="re0">$err</span> <span class="sy0">=</span> <span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">ErrorMsg</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co2"># wrong :(
</span><span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">Save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">ErrorMsg</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="kw1">echo</span> <span class="st0">"Wrong way to detect error"</span><span class="sy0">;</span></pre>

<p>
The ADOConnection::Debug property is obeyed. So if $db&rarr;debug is enabled, then ADOdb_Active_Record errors are also outputted to standard output and written to the browser.
</p>

<p>
ADOdb_Active_Record::Set()
</p>

<p>
You can convert an array to an ADOdb_Active_Record using Set(). The array must be numerically indexed, and have all fields of the table defined in the array. The elements of the array must be in the table's natural order too.
</p>
<pre class="code php"><span class="re0">$row</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetRow</span><span class="br0">(</span><span class="st0">"select * from tablex where id=<span class="es4">$id</span>"</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co2"># PHP4 or PHP5 without enabling exceptions
</span><span class="re0">$obj</span> <span class="sy0">=</span> <span class="kw2">new</span> ADOdb_Active_Record<span class="br0">(</span><span class="st_h">'Products'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$obj</span><span class="sy0">-&gt;</span><span class="me1">ErrorMsg</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="br0">{</span>
	<span class="kw1">echo</span> <span class="re0">$obj</span><span class="sy0">-&gt;</span><span class="me1">ErrorMsg</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
	<span class="re0">$obj</span><span class="sy0">-&gt;</span><span class="me1">Set</span><span class="br0">(</span><span class="re0">$row</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="co2"># in PHP5, with exceptions enabled:
</span>
<span class="kw1">include</span><span class="br0">(</span><span class="st_h">'adodb-exceptions.inc.php'</span><span class="br0">)</span><span class="sy0">;</span>
try <span class="br0">{</span>
	<span class="re0">$obj</span> <span class="sy0">=</span> <span class="kw2">new</span> ADOdb_Active_Record<span class="br0">(</span><span class="st_h">'Products'</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">$obj</span><span class="sy0">-&gt;</span><span class="me1">Set</span><span class="br0">(</span><span class="re0">$row</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span> catch<span class="br0">(</span>exceptions <span class="re0">$e</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="kw1">echo</span> <span class="re0">$e</span><span class="sy0">-&gt;</span><span class="me1">getMessage</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>

</div>

<h2 class="sectionedit20" id="primary_keys">Primary Keys</h2>
<div class="level2">

<p>
ADOdb_Active_Record does not require the table to have a primary key. You can insert records for such a table, but you will not be able to update nor delete.
</p>

<p>
Sometimes you are retrieving data from a view or table that has no primary key, but has a unique index. You can dynamically set the primary key of a table through the constructor:
</p>
<pre class="code php"><span class="re0">$pkeys</span> <span class="sy0">=</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'category'</span><span class="sy0">,</span><span class="st_h">'prodcode'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// set primary key using constructor</span>
<span class="re0">$rec</span> <span class="sy0">=</span> <span class="kw2">new</span> ADOdb_Active_Record<span class="br0">(</span><span class="st_h">'Products'</span><span class="sy0">,</span> <span class="re0">$pkeys</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">// or define a new class</span>
<span class="kw2">class</span> Product <span class="kw2">extends</span> ADOdb_Active_Record <span class="br0">{</span>
    <span class="kw2">function</span> __construct<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
	parent<span class="sy0">::</span>__construct<span class="br0">(</span><span class="st_h">'Products'</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'prodid'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="re0">$rec</span> <span class="sy0">=</span> <span class="kw2">new</span> Product<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit21" id="retrieval_of_auto-incrementing_id">Retrieval of Auto-incrementing ID</h2>
<div class="level2">

<p>
When creating a new record, the retrieval of the last auto-incrementing ID is not reliable for databases that do not support the Insert_ID() function call (check $connection&rarr;hasInsertID). In this case we perform a SELECT MAX($primarykey) FROM $table, which will not work reliably in a multi-user environment. You can override the ADOdb_Active_Record::LastInsertID() function in this case.
Dealing with Multiple Databases
</p>

<p>
Sometimes we want to load data from one database and insert it into another using ActiveRecords. This can be done using the optional parameter of the ADOdb_Active_Record constructor. In the following example, we read data from db.table1 and store it in db2.table2:
</p>
<pre class="code php"><span class="re0">$db</span> <span class="sy0">=</span> NewADOConnection<span class="br0">(</span><span class="sy0">...</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db2</span> <span class="sy0">=</span> NewADOConnection<span class="br0">(</span><span class="sy0">...</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
ADOdb_Active_Record<span class="sy0">::</span><span class="me2">SetDatabaseAdapter</span><span class="br0">(</span><span class="re0">$db2</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$activeRecs</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecords</span><span class="br0">(</span><span class="st_h">'table1'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$activeRecs</span> <span class="kw1">as</span> <span class="re0">$rec</span><span class="br0">)</span> <span class="br0">{</span>
   <span class="re0">$rec2</span> <span class="sy0">=</span> <span class="kw2">new</span> ADOdb_Active_Record<span class="br0">(</span><span class="st_h">'table2'</span><span class="sy0">,</span><span class="re0">$db2</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="re0">$rec2</span><span class="sy0">-&gt;</span><span class="me1">id</span> <span class="sy0">=</span> <span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">id</span><span class="sy0">;</span>
   <span class="re0">$rec2</span><span class="sy0">-&gt;</span><span class="me1">name</span> <span class="sy0">=</span> <span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">name</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$rec2</span><span class="sy0">-&gt;</span><span class="me1">Save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>

<p>
If you have to pass in a primary key called &ldquo;id&rdquo; and the 2nd db connection in the constructor, you can do so too:
</p>

<p>
$rec = new ADOdb_Active_Record(&ldquo;table1&rdquo;,array(&ldquo;id&rdquo;),$db2);
</p>

<p>
You can now give a named label in SetDatabaseAdapter, allowing to determine in your class definition which database to load, using var $_dbat.
</p>
<pre class="code php"><span class="re0">$db1</span> <span class="sy0">=</span> NewADOConnection<span class="br0">(</span><span class="sy0">...</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// some ADOdb DB</span>
ADOdb_Active_Record<span class="sy0">::</span><span class="me2">SetDatabaseAdapter</span><span class="br0">(</span><span class="re0">$db1</span><span class="sy0">,</span> <span class="st_h">'mysql'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db2</span> <span class="sy0">=</span> NewADOConnection<span class="br0">(</span><span class="sy0">...</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// some ADOdb DB</span>
ADOdb_Active_Record<span class="sy0">::</span><span class="me2">SetDatabaseAdapter</span><span class="br0">(</span><span class="re0">$db2</span><span class="sy0">,</span> <span class="st_h">'oracle'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">class</span> FooRecord <span class="kw2">extends</span> ADOdb_Active_Record
<span class="br0">{</span>
<span class="kw2">var</span> <span class="re0">$_dbat</span> <span class="sy0">=</span> <span class="st_h">'mysql'</span><span class="sy0">;</span>  <span class="co1">// uses 'mysql' connection</span>
<span class="sy0">...</span>
<span class="br0">}</span></pre>

</div>

<h2 class="sectionedit22" id="adodb_active_cachesecs">$ADODB_ACTIVE_CACHESECS</h2>
<div class="level2">

<p>
You can cache the table metadata (field names, types, and other info such primary keys) in $ADODB_CACHE_DIR (which defaults to /tmp) by setting the global variable $ADODB_ACTIVE_CACHESECS to a value greater than 0. This will be the number of seconds to cache. You should set this to a value of 30 seconds or greater for optimal performance.
</p>

</div>

<h2 class="sectionedit23" id="active_record_considered_bad">Active Record Considered Bad?</h2>
<div class="level2">

<p>
Although the Active Record concept is useful, you have to be aware of some pitfalls when using Active Record. The level of granularity of Active Record is individual records. It encourages code like the following, used to increase the price of all furniture products by 10%:
</p>
<pre class="code php"><span class="re0">$recs</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecords</span><span class="br0">(</span><span class="st0">"Products"</span><span class="sy0">,</span><span class="st0">"category='Furniture'"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$recs</span> <span class="kw1">as</span> <span class="re0">$rec</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">price</span> <span class="sy0">*=</span> <span class="nu19">1.1</span><span class="sy0">;</span> <span class="co1">// increase price by 10% for all Furniture products</span>
    <span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>

<p>
Of course an UPDATE statement is superior because it's simpler and much more efficient (probably by a factor of x10 or more):
</p>
<pre class="code php"><span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"update Products set price = price * 1.1 where category='Furniture'"</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
For performance sensitive code, using direct SQL will always be faster than using Active Records due to overhead and the fact that all fields in a row are retrieved (rather than only the subset you need) whenever an Active Record is loaded.
</p>

</div>

<h2 class="sectionedit24" id="transactions">Transactions</h2>
<div class="level2">

<p>
The default transaction mode in ADOdb is autocommit. So that is the default with active record too. The general rules for managing transactions still apply. Active Record to the database is a set of insert/update/delete statements, and the db has no knowledge of active records.
</p>

<p>
Smart transactions, that does an auto-rollback if an error occurs, is still the best method to multiple activities (inserts/updates/deletes) that need to be treated as a single transaction:
</p>
<pre class="code php"><span class="re0">$conn</span><span class="sy0">-&gt;</span><span class="me1">StartTrans</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$parent</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$child</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$conn</span><span class="sy0">-&gt;</span><span class="me1">CompleteTrans</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit25" id="one_to_many_relations">One to Many Relations</h2>
<div class="level2">

<p>
Since ADOdb 5.06, we support parent child relationships. This is done using the ClassBelongsTo() and ClassHasMany() functions.
</p>

</div>

<h2 class="sectionedit26" id="classhasmany">ClassHasMany</h2>
<div class="level2">

<p>
To globally define a one-to-many relationship we use the static function ADODB_Active_Record::ClassHasMany($class, $relation, $foreignKey = ' ', $foreignClass = 'ADODB_Active_Record'). For example, we have 2 tables, persons (parent table) and children (child table) linked by persons.id = children.person_id. The variable $person&rarr;children is an array that holds the children. To define this relationship:
</p>
<pre class="code php"><span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span>
ADODB_Active_Record<span class="sy0">::</span><span class="me2">ClassHasMany</span><span class="br0">(</span><span class="st_h">'person'</span><span class="sy0">,</span> <span class="st_h">'children'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st0">"id=1"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">children</span> <span class="kw1">as</span> <span class="re0">$c</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">echo</span> <span class="st0">" <span class="es4">$c-&gt;name_first</span> "</span><span class="sy0">;</span>
    <span class="re0">$c</span><span class="sy0">-&gt;</span><span class="me1">name_first</span> <span class="sy0">.=</span> <span class="st_h">' K.'</span><span class="sy0">;</span>
    <span class="re0">$c</span><span class="sy0">-&gt;</span><span class="me1">Save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>  <span class="co2">## each child record must be saved individually
</span><span class="br0">}</span></pre>

<p>
If no data is loaded, then children is set to an empty array:
</p>
<pre class="code php"><span class="re0">$person2</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$p</span> <span class="sy0">=</span> <span class="re0">$person2</span><span class="sy0">-&gt;</span><span class="me1">children</span><span class="sy0">;</span>  <span class="co2">## $p is an empty array()</span></pre>

<p>
By default, data returned by HasMany() is unsorted. To define an order by clause (or define a SELECT LIMIT window), see LoadRelations() below. Another point is that all children are loaded only when the child member is accessed (in  
</p>
<pre class="code php">__get<span class="br0">(</span><span class="br0">)</span></pre>

<p>
), and not when the Load() function of the parent object is called. This helps to conserve memory.
</p>

<p>
To create and save new parent and child records:
</p>
<pre class="code php"><span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span>
<span class="kw2">class</span> children <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span>
ADODB_Active_Record<span class="sy0">::</span><span class="me2">ClassHasMany</span><span class="br0">(</span><span class="st_h">'person'</span><span class="sy0">,</span> <span class="st_h">'children'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">for</span> <span class="br0">(</span><span class="re0">$i</span><span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$i</span><span class="sy0">&lt;</span><span class="nu0">10</span><span class="sy0">;</span> <span class="re0">$i</span><span class="sy0">++</span><span class="br0">)</span>
    <span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">children</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">=</span> <span class="kw2">new</span> children<span class="br0">(</span><span class="st_h">'children'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// modify fields of $person, then...</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">children</span> <span class="kw1">as</span> <span class="re0">$c</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="co1">// modify fields of $c then...</span>
    <span class="re0">$c</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>

<p>
You can have multiple relationships (warning: relations are case-sensitive, 'Children' !== 'children'):
</p>
<pre class="code php">ADODB_Active_Record<span class="sy0">::</span><span class="me2">ClassHasMany</span><span class="br0">(</span><span class="st_h">'person'</span><span class="sy0">,</span> <span class="st_h">'children'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="br0">)</span><span class="sy0">;</span>
ADODB_Active_Record<span class="sy0">::</span><span class="me2">ClassHasMany</span><span class="br0">(</span><span class="st_h">'person'</span><span class="sy0">,</span> <span class="st_h">'siblings'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st_h">'id=1'</span><span class="br0">)</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">children</span><span class="br0">)</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">siblings</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
By default, the child class is ADOdb_Active_Record. Sometimes you might want the child class to be based on your own class which has additional functions. You can do so using the last parameter:
</p>
<pre class="code php"><span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span>
<span class="kw2">class</span> child <span class="kw2">extends</span> ADOdb_Active_Record <span class="br0">{</span> <span class="sy0">....</span> some modifications here <span class="sy0">...</span> <span class="br0">}</span>
ADODB_Active_Record<span class="sy0">::</span><span class="me2">ClassHasMany</span><span class="br0">(</span><span class="st_h">'person'</span><span class="sy0">,</span> <span class="st_h">'children'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="sy0">,</span> <span class="st_h">'child'</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
Lastly some troubleshooting issues. We use the 
</p>
<pre class="code php">__get<span class="br0">(</span><span class="br0">)</span></pre>

<p>
 method to set $p&rarr;children below. So once $p&rarr;children is defined by accessing it, we don't change the child reference, as shown below:
</p>
<pre class="code php">ADODB_Active_Record<span class="sy0">::</span><span class="me2">ClassHasMany</span><span class="br0">(</span><span class="st_h">'person'</span><span class="sy0">,</span> <span class="st_h">'children'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$p</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$p</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st_h">'id=1'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co2"># $p-&gt;children points to person_id = 1
</span><a target="_blank" href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">(</span><span class="re0">$p</span><span class="sy0">-&gt;</span><span class="me1">children</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$p</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st_h">'id=2'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co2"># $p-&gt;children still points to person_id = 1
</span><a target="_blank" href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">(</span><span class="re0">$p</span><span class="sy0">-&gt;</span><span class="me1">children</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
The solution to the above is to unset($p&rarr;children) before $p&rarr;Load('id=2').
</p>

</div>

<h2 class="sectionedit27" id="tablehasmany">TableHasMany</h2>
<div class="level2">

<p>
For some classes, the mapping between class name and table name (which is the pluralised version) might not match. For example, the class name might be person, but the table name might be people. So we have 2 tables, people (parent table) and children (child table) linked by people.id = children.person_id.
Then you use the following static function ADODB_Active_Record::TableHasMany($table, $relation, $foreignKey = ' ', $foreignClass = 'ADODB_Active_Record') like this:
</p>

<p>
ADODB_Active_Record::TableHasMany('people', 'children', 'person_id')
</p>

</div>

<h2 class="sectionedit28" id="tablekeyhasmany">TableKeyHasMany</h2>
<div class="level2">

<p>
For some classes, the mapping between class name and table name (which is the pluralised version) might not match or the primary key is not the default id. For example, the class name might be person, but the table name might be people. So we have 2 tables, people (parent table) and children (child table) linked by people.pid = children.person_id.
</p>

<p>
Then you use the following static function ADODB_Active_Record::TableKeyHasMany($table, $tablePKey, $relation, $foreignKey = ' ', $foreignClass = 'ADODB_Active_Record') like this:
</p>

<p>
ADODB_Active_Record::TableKeyHasMany('people', 'pid', 'children', 'person_id')
A Complete ClassHasMany example
</p>

<p>
Here is sample usage using mysql:
</p>
<pre class="code php"><span class="kw1">include_once</span><span class="br0">(</span><span class="st_h">'../adodb.inc.php'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">include_once</span><span class="br0">(</span><span class="st_h">'../adodb-active-record.inc.php'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$db</span> <span class="sy0">=</span> NewADOConnection<span class="br0">(</span><span class="st_h">'mysql://root@localhost/northwind'</span><span class="br0">)</span><span class="sy0">;</span>
ADOdb_Active_Record<span class="sy0">::</span><span class="me2">SetDatabaseAdapter</span><span class="br0">(</span><span class="re0">$db</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"CREATE TEMPORARY TABLE `persons` (
               `id` int(10) unsigned NOT NULL auto_increment,
                `name_first` varchar(100) NOT NULL default '',
                `name_last` varchar(100) NOT NULL default '',
                `favorite_color` varchar(100) NOT NULL default '',
                PRIMARY KEY  (`id`)
            ) ENGINE=MyISAM;
           "</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"CREATE TEMPORARY TABLE `children` (
                `id` int(10) unsigned NOT NULL auto_increment,
				`person_id` int(10) unsigned NOT NULL,
				`gender` varchar(10) default 'F',
                `name_first` varchar(100) NOT NULL default '',
                `name_last` varchar(100) NOT NULL default '',
                `favorite_pet` varchar(100) NOT NULL default '',
                PRIMARY KEY  (`id`)
            ) ENGINE=MyISAM;
           "</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"insert into children (person_id,name_first,name_last) values (1,'Jill','Lim')"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"insert into children (person_id,name_first,name_last) values (1,'Joan','Lim')"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"insert into children (person_id,name_first,name_last) values (1,'JAMIE','Lim')"</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span>
ADODB_Active_Record<span class="sy0">::</span><span class="me2">ClassHasMany</span><span class="br0">(</span><span class="st_h">'person'</span><span class="sy0">,</span> <span class="st_h">'children'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_first</span>     <span class="sy0">=</span> <span class="st_h">'John'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_last</span>      <span class="sy0">=</span> <span class="st_h">'Lim'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">favorite_color</span> <span class="sy0">=</span> <span class="st_h">'lavender'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// this save will perform an INSERT successfully</span>
&nbsp;
<span class="re0">$person2</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co2"># no need to define HasMany() again, adodb remembers definition
</span><span class="re0">$person2</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st_h">'id=1'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$c</span> <span class="sy0">=</span> <span class="re0">$person2</span><span class="sy0">-&gt;</span><span class="me1">children</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">(</span><a target="_blank" href="http://www.php.net/is_array"><span class="kw3">is_array</span></a><span class="br0">(</span><span class="re0">$c</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <a target="_blank" href="http://www.php.net/sizeof"><span class="kw3">sizeof</span></a><span class="br0">(</span><span class="re0">$c</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">3</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$c</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">-&gt;</span><span class="me1">name_first</span><span class="sy0">==</span><span class="st_h">'Jill'</span> <span class="sy0">&amp;&amp;</span> <span class="re0">$c</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">-&gt;</span><span class="me1">name_first</span><span class="sy0">==</span><span class="st_h">'Joan'</span>
	<span class="sy0">&amp;&amp;</span> <span class="re0">$c</span><span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="sy0">-&gt;</span><span class="me1">name_first</span> <span class="sy0">==</span> <span class="st_h">'JAMIE'</span><span class="br0">)</span> <span class="kw1">echo</span> <span class="st0">"OK Loaded HasMany&lt;br&gt;"</span><span class="sy0">;</span>
<span class="kw1">else</span> <span class="br0">{</span>
    <span class="kw1">echo</span> <span class="st0">"Error loading hasMany should have 3 array elements Jill Joan Jamie&lt;br&gt;"</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="sy0">=====</span> HasMany <span class="sy0">=====</span>
&nbsp;
This older method is deprecated and ClassHasMany<span class="sy0">/</span>TableHasMany<span class="sy0">/</span>TableKeyHasMany should be used<span class="sy0">.</span>
&nbsp;
The older way to <a target="_blank" href="http://www.php.net/define"><span class="kw3">define</span></a> a one<span class="sy0">-</span>to<span class="sy0">-</span>many relationship is to <span class="kw2">use</span> <span class="re0">$parentobj</span><span class="sy0">-&gt;</span><span class="me1">HasMany</span><span class="br0">(</span><span class="re0">$relation</span><span class="sy0">,</span> <span class="re0">$foreignKey</span> <span class="sy0">=</span> <span class="st_h">' '</span><span class="br0">)</span><span class="sy0">.</span> <span class="kw1">For</span> example<span class="sy0">,</span> we have <span class="nu0">2</span> tables<span class="sy0">,</span> persons <span class="br0">(</span>parent table<span class="br0">)</span> and children <span class="br0">(</span>child table<span class="br0">)</span> linked by persons<span class="sy0">.</span>id <span class="sy0">=</span> children<span class="sy0">.</span>person_id<span class="sy0">.</span> The variable <span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">children</span> is an <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a> that holds the children<span class="sy0">.</span> To <a target="_blank" href="http://www.php.net/define"><span class="kw3">define</span></a> this relationship<span class="sy0">:</span>
<span class="sy0">&lt;</span>code php<span class="sy0">&gt;</span>
<span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span>
&nbsp;
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">HasMany</span><span class="br0">(</span><span class="st_h">'children'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st0">"id=1"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">children</span> <span class="kw1">as</span> <span class="re0">$c</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">echo</span> <span class="st0">" <span class="es4">$c-&gt;name_first</span> "</span><span class="sy0">;</span>
    <span class="re0">$c</span><span class="sy0">-&gt;</span><span class="me1">name_first</span> <span class="sy0">.=</span> <span class="st_h">' K.'</span><span class="sy0">;</span>
    <span class="re0">$c</span><span class="sy0">-&gt;</span><span class="me1">Save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>  <span class="co2">## each child record must be saved individually
</span><span class="br0">}</span></pre>

<p>
This HasMany() definition is global for the current script. This means that you only need to define it once. In the following example, $person2 knows about children.
</p>
<pre class="code php"><span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">HasMany</span><span class="br0">(</span><span class="st_h">'children'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$person2</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st0">"id=1"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$p</span> <span class="sy0">=</span> <span class="re0">$person2</span><span class="sy0">-&gt;</span><span class="me1">children</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit29" id="classbelongsto">ClassBelongsTo</h2>
<div class="level2">

<p>
You can define the parent of the current object using ADODB_Active_Record::ClassBelongsTo($class, $relationName, $foreignKey, $parentPrimaryKey = 'id', $parentClass = 'ADODB_Active_Record'). In the example below, we have a child table kids, and a parent table person. We have a link kids.person_id = persons.id. We create a child first, then link it to the parent:
</p>
<pre class="code">class kid extends ADOdb_Active_Record{};
ADODB_Active_Record::ClassBelongsTo('kid','person','person_id','id');</pre>
<pre class="code">$ch = new kid(); // default tablename will be 'kids', with primary key 'id'
$ch-&gt;Load('id=1');
$p = $ch-&gt;person;
if (!$p || $p-&gt;name_first != 'John') echo "Error loading belongsTo&lt;br&gt;";
else echo "OK loading BelongTo&lt;br&gt;";</pre>

<p>
Note that relationships are case-sensitive, so ClassBelongsTo('kid','PARENT', 'parent_id') and ClassBelongsTo('kid', 'parent', 'parent_id') are not the same.
</p>

<p>
Also if no data is loaded into the child instance, then $p will return null;
</p>
<pre class="code php">ADODB_Active_Record<span class="sy0">::</span><span class="me2">ClassBelongsTo</span><span class="br0">(</span><span class="st_h">'kid'</span><span class="sy0">,</span><span class="st_h">'person'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="sy0">,</span><span class="st_h">'id'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$ch</span> <span class="sy0">=</span> <span class="kw2">new</span> kid<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$p</span> <span class="sy0">=</span> <span class="re0">$ch</span><span class="sy0">-&gt;</span><span class="me1">person</span><span class="sy0">;</span> <span class="co2"># $p is null</span></pre>

<p>
Another way to define the class of the parent (which otherwise defaults to ADODB_Active_Record) as follows:
</p>
<pre class="code php"><span class="kw2">class</span> kid <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span><span class="sy0">;</span>
<span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="sy0">...</span> your modifications <span class="sy0">...</span> <span class="br0">}</span><span class="sy0">;</span>
ADODB_Active_Record<span class="sy0">::</span><span class="me2">ClassBelongsTo</span><span class="br0">(</span><span class="st_h">'kid'</span><span class="sy0">,</span><span class="st_h">'person'</span><span class="sy0">,</span><span class="st_h">'person_id'</span><span class="sy0">,</span><span class="st_h">'id'</span><span class="sy0">,</span> <span class="st_h">'person'</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit30" id="tablebelongsto">TableBelongsTo</h2>
<div class="level2">

<p>
If the child table differs from the convention that the child table name is the plural of the child class name, use this function: ADODB_Active_Record::TableBelongsTo($childTable, $relationName, $foreignKey, $parentPrimaryKey = 'id', $parentClass = 'ADODB_Active_Record').
</p>

<p>
E.g. the class is child, but the table name is children, and the link between the two tables is children.person_id = person.id:
</p>

<p>
 ADODB_Active_Record::TableBelongsTo('children','person','person_id','id');
</p>

</div>

<h2 class="sectionedit31" id="tablekeybelongsto">TableKeyBelongsTo</h2>
<div class="level2">

<p>
If the child table differs from the convention that the child table name is the plural of the child class name or the primary key is not 'id', use this function: ADODB_Active_Record::TableKeyBelongsTo($childTable, $childKey, $relationName, $foreignKey, $parentPrimaryKey = 'id', $parentClass = 'ADODB_Active_Record').
</p>

<p>
E.g. the class is child, but the table name is children and primary key is ch_id, and the link between the two tables is children.person_id = person.id:
</p>

<p>
ADODB_Active_Record::TableKeyBelongsTo('children','ch_id', 'person','person_id','id');
</p>

</div>

<h2 class="sectionedit32" id="belongsto">BelongsTo</h2>
<div class="level2">

<p>
The following is deprecated. Use ClassBelongsTo/TableBelongsTo/TableKeyBelongsTo instead.
</p>

<p>
The older way to define the parent of the current object is using BelongsTo($relationName, $foreignKey, $parentPrimaryKey = 'id'). In the example below, we have a child table children, and a parent table person. We have a link children.person_id = persons.id. We create a child first, then link it to the parent:
</p>
<pre class="code">class Child extends ADOdb_Active_Record{};
$ch = new Child('children',array('id'));
$ch-&gt;BelongsTo('person','person_id','id');  ## this can be simplified to $ch-&gt;BelongsTo('person')
                                            ## as foreign key defaults to $table.'_id' and
                                            ## parent pkey defaults to 'id'
$ch-&gt;Load('id=1');
$p = $ch-&gt;person;
if (!$p || $p-&gt;name_first != 'John') echo "Error loading belongsTo&lt;br&gt;";
else echo "OK loading BelongTo&lt;br&gt;";</pre>

<p>
You only need to define BelongsTo() once in a script as it is global for all instances.
</p>

</div>

<h2 class="sectionedit33" id="loadrelations">LoadRelations</h2>
<div class="level2">

<p>
Sometimes you want to load only a subset of data in a relationship. For example, you could load all female children sorted by children.name using LoadRelations($relation, $whereOrderBy = ' ', $offset = -1, $limit = -1):
</p>
<pre class="code php"><span class="co2"># assume this has been called:
</span><span class="co2">#   ADODB_Active_Record::ClassHasMany('person', 'children','person_id');
</span><span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st_h">'id=23'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co2"># Load doesn't load children until $person-&gt;children is accessed or LoadRelations is called:
</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">LoadRelations</span><span class="br0">(</span><span class="st_h">'children'</span><span class="sy0">,</span><span class="st0">"gender='F' order by name"</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
Lastly, if you have lots of child data, you can define a window of data of records to load. In the following example, we load a window of 100 records at a time:
</p>
<pre class="code php"><span class="co2"># assume this has been called:
</span><span class="co2">#  ADODB_Active_Record::ClassHasMany('Account', 'transactions','account_id');
</span><span class="co2">#acc = new Account();
</span><span class="re0">$acc</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st_h">'id=23'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$start</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="kw1">while</span><span class="br0">(</span><span class="kw4">true</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="re0">$acc</span><span class="sy0">-&gt;</span><span class="me1">LoadRelations</span><span class="br0">(</span><span class="st_h">'transactions'</span><span class="sy0">,</span><span class="st0">"tx_done=0 order by trxdate"</span><span class="sy0">,</span> <span class="re0">$start</span><span class="sy0">,</span> <span class="re0">$start</span><span class="sy0">+</span><span class="nu0">100</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span><span class="re0">$acc</span><span class="sy0">-&gt;</span><span class="me1">transactions</span><span class="br0">)</span> <span class="kw1">break</span><span class="sy0">;</span>
    <span class="kw1">foreach</span> <span class="br0">(</span><span class="re0">$acc</span><span class="sy0">-&gt;</span><span class="me1">transactions</span> <span class="kw1">as</span> <span class="re0">$k</span> <span class="sy0">=&gt;</span> <span class="re0">$trx</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="co2">## process
</span>	<span class="re0">$trx</span><span class="sy0">-&gt;</span><span class="me1">tx_done</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
	<span class="re0">$trx</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    <span class="re0">$start</span> <span class="sy0">+=</span> <span class="nu0">100</span><span class="sy0">;</span>
    <a target="_blank" href="http://www.php.net/unset"><span class="kw3">unset</span></a><span class="br0">(</span><span class="re0">$acc</span><span class="sy0">-&gt;</span><span class="me1">transactions</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="br0">}</span></pre>

<p>
The $offset is 0-based, and $limit is the number of records to retrieve. The default is to ignore $offset (-1) and $limit (-1).
</p>

</div>

<h2 class="sectionedit34" id="acknowledgements">Acknowledgements</h2>
<div class="level2">

<p>
Thanks to Chris Ravenscroft for original one-to-many code (chris#voilaweb.com).
</p>

</div>

<h2 class="sectionedit35" id="adoconnection_supplement">ADOConnection Supplement</h2>
<div class="level2">

</div>

<h3 class="sectionedit36" id="adoconnectiongetactiverecords">ADOConnection::GetActiveRecords()</h3>
<div class="level3">

<p>
This allows you to retrieve an array of ADOdb_Active_Records. Returns false if an error occurs.
</p>
<pre class="code php"><span class="re0">$table</span> <span class="sy0">=</span> <span class="st_h">'products'</span><span class="sy0">;</span>
<span class="re0">$whereOrderBy</span> <span class="sy0">=</span> <span class="st0">"name LIKE 'A%' ORDER BY Name"</span><span class="sy0">;</span>
<span class="re0">$activeRecArr</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecords</span><span class="br0">(</span><span class="re0">$table</span><span class="sy0">,</span> <span class="re0">$whereOrderBy</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$activeRecArr</span> <span class="kw1">as</span> <span class="re0">$rec</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">id</span> <span class="sy0">=</span> <a target="_blank" href="http://www.php.net/rand"><span class="kw3">rand</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>

<p>
And to retrieve all records ordered by specific fields:
</p>
<pre class="code php"><span class="re0">$whereOrderBy</span> <span class="sy0">=</span> <span class="st0">"1=1 ORDER BY Name"</span><span class="sy0">;</span>
<span class="re0">$activeRecArr</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecords</span><span class="br0">(</span><span class="re0">$table</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">//To use bind variables (assuming ? is the place-holder for your database):</span>
&nbsp;
<span class="re0">$activeRecArr</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecords</span><span class="br0">(</span><span class="re0">$tableName</span><span class="sy0">,</span> <span class="st_h">'name LIKE ?'</span><span class="sy0">,</span>
						<a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'A%'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
You can also <a target="_blank" href="http://www.php.net/define"><span class="kw3">define</span></a> the primary keys of the table by passing an <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a> of field names<span class="sy0">:</span>
&nbsp;
<span class="re0">$activeRecArr</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecords</span><span class="br0">(</span><span class="re0">$tableName</span><span class="sy0">,</span> <span class="st_h">'name LIKE ?'</span><span class="sy0">,</span>
						<a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'A%'</span><span class="br0">)</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'id'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
ADOConnection<span class="sy0">::</span><span class="me2">GetActiveRecordsClass</span><span class="br0">(</span><span class="br0">)</span></pre>

<p>
This allows you to retrieve an array of objects derived from ADOdb_Active_Records. Returns false if an error occurs.
</p>
<pre class="code php"><span class="kw2">class</span> Product <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span><span class="sy0">;</span>
<span class="re0">$table</span> <span class="sy0">=</span> <span class="st_h">'products'</span><span class="sy0">;</span>
<span class="re0">$whereOrderBy</span> <span class="sy0">=</span> <span class="st0">"name LIKE 'A%' ORDER BY Name"</span><span class="sy0">;</span>
<span class="re0">$activeRecArr</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecordsClass</span><span class="br0">(</span><span class="st_h">'Product'</span><span class="sy0">,</span><span class="re0">$table</span><span class="sy0">,</span> <span class="re0">$whereOrderBy</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co2"># the objects in $activeRecArr are of class 'Product'
</span><span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$activeRecArr</span> <span class="kw1">as</span> <span class="re0">$rec</span><span class="br0">)</span> <span class="br0">{</span>
	<span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">id</span> <span class="sy0">=</span> <a target="_blank" href="http://www.php.net/rand"><span class="kw3">rand</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">$rec</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>

<p>
To use bind variables (assuming ? is the place-holder for your database):
</p>
<pre class="code php"><span class="re0">$activeRecArr</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecordsClass</span><span class="br0">(</span><span class="re0">$className</span><span class="sy0">,</span><span class="re0">$tableName</span><span class="sy0">,</span> <span class="st_h">'name LIKE ?'</span><span class="sy0">,</span>
						<a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'A%'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
You can also <a target="_blank" href="http://www.php.net/define"><span class="kw3">define</span></a> the primary keys of the table by passing an <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a> of field names<span class="sy0">:</span>
&nbsp;
<span class="re0">$activeRecArr</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecordsClass</span><span class="br0">(</span><span class="re0">$className</span><span class="sy0">,</span><span class="re0">$tableName</span><span class="sy0">,</span> <span class="st_h">'name LIKE ?'</span><span class="sy0">,</span>
						<a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'A%'</span><span class="br0">)</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'id'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
ADOConnection::ErrorMsg()
</p>

<p>
Returns last error message.
</p>

<p>
ADOConnection::ErrorNo()
</p>

<p>
Returns last error number.
</p>

</div>

<h2 class="sectionedit37" id="activerecord_code_sample">ActiveRecord Code Sample</h2>
<div class="level2">
<pre class="code php"><span class="kw1">include</span><span class="br0">(</span><span class="st_h">'../adodb.inc.php'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">include</span><span class="br0">(</span><span class="st_h">'../adodb-active-record.inc.php'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// uncomment the following if you want to test exceptions</span>
<span class="co2">#if (PHP_VERSION &gt;= 5) include('../adodb-exceptions.inc.php');
</span>
<span class="re0">$db</span> <span class="sy0">=</span> NewADOConnection<span class="br0">(</span><span class="st_h">'mysql://root@localhost/northwind'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">debug</span><span class="sy0">=</span><span class="nu0">1</span><span class="sy0">;</span>
ADOdb_Active_Record<span class="sy0">::</span><span class="me2">SetDatabaseAdapter</span><span class="br0">(</span><span class="re0">$db</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"CREATE TEMPORARY TABLE `persons` (
                `id` int(10) unsigned NOT NULL auto_increment,
                `name_first` varchar(100) NOT NULL default '',
                `name_last` varchar(100) NOT NULL default '',
                `favorite_color` varchar(100) NOT NULL default '',
                PRIMARY KEY  (`id`)
            ) ENGINE=MyISAM;
           "</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">class</span> person <span class="kw2">extends</span> ADOdb_Active_Record<span class="br0">{</span><span class="br0">}</span>
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"&lt;p&gt;Output of getAttributeNames: "</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">getAttributeNames</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co4">/**
 * Outputs the following:
 * array(4) {
 *    [0]=&gt;
 *    string(2) "id"
 *    [1]=&gt;
 *    string(9) "name_first"
 *    [2]=&gt;
 *    string(8) "name_last"
 *    [3]=&gt;
 *    string(13) "favorite_color"
 *  }
 */</span>
&nbsp;
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_first</span> <span class="sy0">=</span> <span class="st_h">'Andi'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_last</span>  <span class="sy0">=</span> <span class="st_h">'Gutmans'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// this save() will fail on INSERT as favorite_color is a must fill...</span>
&nbsp;
&nbsp;
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_first</span>     <span class="sy0">=</span> <span class="st_h">'Andi'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_last</span>      <span class="sy0">=</span> <span class="st_h">'Gutmans'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">favorite_color</span> <span class="sy0">=</span> <span class="st_h">'blue'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// this save will perform an INSERT successfully</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"&lt;p&gt;The Insert ID generated:"</span><span class="sy0">;</span> <a target="_blank" href="http://www.php.net/print_r"><span class="kw3">print_r</span></a><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">id</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">favorite_color</span> <span class="sy0">=</span> <span class="st_h">'red'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// this save() will perform an UPDATE</span>
&nbsp;
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_first</span>     <span class="sy0">=</span> <span class="st_h">'John'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_last</span>      <span class="sy0">=</span> <span class="st_h">'Lim'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">favorite_color</span> <span class="sy0">=</span> <span class="st_h">'lavender'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// this save will perform an INSERT successfully</span>
&nbsp;
<span class="co1">// load record where id=2 into a new ADOdb_Active_Record</span>
<span class="re0">$person2</span> <span class="sy0">=</span> <span class="kw2">new</span> person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person2</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st_h">'id=2'</span><span class="br0">)</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">(</span><span class="re0">$person2</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// retrieve an array of records</span>
<span class="re0">$activeArr</span> <span class="sy0">=</span> <span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">GetActiveRecordsClass</span><span class="br0">(</span><span class="re0">$class</span> <span class="sy0">=</span> <span class="st0">"person"</span><span class="sy0">,</span><span class="re0">$table</span> <span class="sy0">=</span> <span class="st0">"persons"</span><span class="sy0">,</span><span class="st0">"id="</span><span class="sy0">.</span><span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Param</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">,</span><a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person2</span> <span class="sy0">=</span> <span class="re0">$activeArr</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"&lt;p&gt;Name first (should be John): "</span><span class="sy0">,</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_first</span><span class="sy0">,</span> <span class="st0">"&lt;br&gt;Class = "</span><span class="sy0">,</span><a target="_blank" href="http://www.php.net/get_class"><span class="kw3">get_class</span></a><span class="br0">(</span><span class="re0">$person2</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit38" id="active_record_extended">Active Record eXtended</h2>
<div class="level2">

<p>
This is the original one-to-many Active Record implementation submitted by Chris Ravenscroft (chris#voilaweb.com). The reason why we are offering both versions is that the Extended version is more powerful but more complex. My personal preference is to keep it simpler, but your view may vary.
</p>

<p>
To use, just include adodb-active-recordx.inc.php instead of adodb-active-record.inc.php.
</p>

<p>
It provides a new function called Find() that is quite intuitive to use as shown in the example below. It also supports loading all relationships using a single query (using joins).
</p>
<pre class="code php"><span class="kw2">function</span> ar_assert<span class="br0">(</span><span class="re0">$obj</span><span class="sy0">,</span> <span class="re0">$cond</span><span class="br0">)</span>
<span class="br0">{</span>
     <span class="kw2">global</span> <span class="re0">$err_count</span><span class="sy0">;</span>
     <span class="re0">$res</span> <span class="sy0">=</span> <a target="_blank" href="http://www.php.net/var_export"><span class="kw3">var_export</span></a><span class="br0">(</span><span class="re0">$obj</span><span class="sy0">,</span> <span class="kw4">true</span><span class="br0">)</span><span class="sy0">;</span>
     <span class="kw1">return</span> <span class="br0">(</span><a target="_blank" href="http://www.php.net/strpos"><span class="kw3">strpos</span></a><span class="br0">(</span><span class="re0">$res</span><span class="sy0">,</span> <span class="re0">$cond</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">include_once</span><span class="br0">(</span><span class="st_h">'../adodb.inc.php'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">include_once</span><span class="br0">(</span><span class="st_h">'../adodb-active-recordx.inc.php'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
&nbsp;
<span class="re0">$db</span> <span class="sy0">=</span> NewADOConnection<span class="br0">(</span><span class="st_h">'mysql://root@localhost/northwind'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">debug</span><span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span>
ADOdb_Active_Record<span class="sy0">::</span><span class="me2">SetDatabaseAdapter</span><span class="br0">(</span><span class="re0">$db</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"&lt;pre&gt;<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"Preparing database using SQL queries (creating 'people', 'children')<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"DROP TABLE `people`"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"DROP TABLE `children`"</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"CREATE TABLE `people` (
                `id` int(10) unsigned NOT NULL auto_increment,
                `name_first` varchar(100) NOT NULL default '',
                `name_last` varchar(100) NOT NULL default '',
                `favorite_color` varchar(100) NOT NULL default '',
                PRIMARY KEY  (`id`)
            ) ENGINE=MyISAM;
           "</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"CREATE TABLE `children` (
                `id` int(10) unsigned NOT NULL auto_increment,
				`person_id` int(10) unsigned NOT NULL,
                `name_first` varchar(100) NOT NULL default '',
                `name_last` varchar(100) NOT NULL default '',
                `favorite_pet` varchar(100) NOT NULL default '',
                PRIMARY KEY  (`id`)
            ) ENGINE=MyISAM;
           "</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"insert into children (person_id,name_first,name_last,favorite_pet) values (1,'Jill','Lim','tortoise')"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"insert into children (person_id,name_first,name_last) values (1,'Joan','Lim')"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">Execute</span><span class="br0">(</span><span class="st0">"insert into children (person_id,name_first,name_last) values (1,'JAMIE','Lim')"</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// This class _implicitely_ relies on the 'people' table (pluralized form of 'person')</span>
<span class="kw2">class</span> Person <span class="kw2">extends</span> ADOdb_Active_Record
<span class="br0">{</span>
    <span class="kw2">function</span> __construct<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
	parent<span class="sy0">::</span>__construct<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">hasMany</span><span class="br0">(</span><span class="st_h">'children'</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
<span class="co1">// This class _implicitely_ relies on the 'children' table</span>
<span class="kw2">class</span> Child <span class="kw2">extends</span> ADOdb_Active_Record
<span class="br0">{</span>
    <span class="kw2">function</span> __construct<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
	parent<span class="sy0">::</span>__construct<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">belongsTo</span><span class="br0">(</span><span class="st_h">'person'</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="co1">// This class _explicitely_ relies on the 'children' table and shares its metadata with Child</span>
<span class="kw2">class</span> Kid <span class="kw2">extends</span> ADOdb_Active_Record
<span class="br0">{</span>
    <span class="kw2">function</span> __construct<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
	parent<span class="sy0">::</span>__construct<span class="br0">(</span><span class="st_h">'children'</span><span class="br0">)</span><span class="sy0">;</span>
	<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">belongsTo</span><span class="br0">(</span><span class="st_h">'person'</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="co1">// This class _explicitely_ relies on the 'children' table but does not share its metadata</span>
<span class="kw2">class</span> Rugrat <span class="kw2">extends</span> ADOdb_Active_Record
<span class="br0">{</span>
    <span class="kw2">function</span> __construct<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
	parent<span class="sy0">::</span>__construct<span class="br0">(</span><span class="st_h">'children'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'new'</span> <span class="sy0">=&gt;</span> <span class="kw4">true</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"Inserting person in 'people' table ('John Lim, he likes lavender')<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$person</span> <span class="sy0">=</span> <span class="kw2">new</span> Person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_first</span>     <span class="sy0">=</span> <span class="st_h">'John'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">name_last</span>      <span class="sy0">=</span> <span class="st_h">'Lim'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">favorite_color</span> <span class="sy0">=</span> <span class="st_h">'lavender'</span><span class="sy0">;</span>
<span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// this save will perform an INSERT successfully</span>
&nbsp;
<span class="re0">$err_count</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"person-&gt;Find('id=1') [Lazy Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"person is loaded but its children will be loaded on-demand later on<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$person5</span> <span class="sy0">=</span> <span class="kw2">new</span> Person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$people5</span> <span class="sy0">=</span> <span class="re0">$person5</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st_h">'id=1'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$people5</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'John'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found John<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$people5</span><span class="sy0">,</span> <span class="st0">"'favorite_pet' =&gt; 'tortoise'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[!!] Found relation when I shouldn't<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[OK] No relation yet<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$people5</span> <span class="kw1">as</span> <span class="re0">$person</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$person</span><span class="sy0">-&gt;</span><span class="me1">children</span> <span class="kw1">as</span> <span class="re0">$child</span><span class="br0">)</span>
    <span class="br0">{</span>
	<span class="kw1">if</span><span class="br0">(</span><span class="re0">$child</span><span class="sy0">-&gt;</span><span class="me1">name_first</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$people5</span><span class="sy0">,</span> <span class="st0">"'favorite_pet' =&gt; 'tortoise'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found relation: child<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Missing relation: child<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"person-&gt;Find('id=1' ... ADODB_WORK_AR) [Worker Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"person is loaded, and so are its children<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$person6</span> <span class="sy0">=</span> <span class="kw2">new</span> Person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$people6</span> <span class="sy0">=</span> <span class="re0">$person6</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st_h">'id=1'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'loading'</span> <span class="sy0">=&gt;</span> ADODB_WORK_AR<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$people6</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'John'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found John<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$people6</span><span class="sy0">,</span> <span class="st0">"'favorite_pet' =&gt; 'tortoise'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found relation: child<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Missing relation: child<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"person-&gt;Find('id=1' ... ADODB_JOIN_AR) [Join Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"person and its children are loaded using a single query<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$person7</span> <span class="sy0">=</span> <span class="kw2">new</span> Person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">// When I specifically ask for a join, I have to specify which table id I am looking up</span>
<span class="co1">// otherwise the SQL parser will wonder which table's id that would be.</span>
<span class="re0">$people7</span> <span class="sy0">=</span> <span class="re0">$person7</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st_h">'people.id=1'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'loading'</span> <span class="sy0">=&gt;</span> ADODB_JOIN_AR<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$people7</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'John'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found John<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$people7</span><span class="sy0">,</span> <span class="st0">"'favorite_pet' =&gt; 'tortoise'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found relation: child<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Missing relation: child<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"person-&gt;Load('people.id=1') [Join Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"Load() always uses the join method since it returns only one row<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$person2</span> <span class="sy0">=</span> <span class="kw2">new</span> Person<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">// Under the hood, Load(), since it returns only one row, always perform a join</span>
<span class="co1">// Therefore we need to clarify which id we are talking about.</span>
<span class="re0">$person2</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st_h">'people.id=1'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$person2</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'John'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found John<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$person2</span><span class="sy0">,</span> <span class="st0">"'favorite_pet' =&gt; 'tortoise'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found relation: child<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Missing relation: child<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"child-&gt;Load('children.id=1') [Join Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"We are now loading from the 'children' table, not from 'people'<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$ch</span> <span class="sy0">=</span> <span class="kw2">new</span> Child<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ch</span><span class="sy0">-&gt;</span><span class="me1">Load</span><span class="br0">(</span><span class="st_h">'children.id=1'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ch</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'Jill'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found Jill<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ch</span><span class="sy0">,</span> <span class="st0">"'favorite_color' =&gt; 'lavender'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found relation: person<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Missing relation: person<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"child-&gt;Find('children.id=1' ... ADODB_WORK_AR) [Worker Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$ch2</span> <span class="sy0">=</span> <span class="kw2">new</span> Child<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ach2</span> <span class="sy0">=</span> <span class="re0">$ch2</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st_h">'id=1'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'loading'</span> <span class="sy0">=&gt;</span> ADODB_WORK_AR<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach2</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'Jill'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found Jill<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach2</span><span class="sy0">,</span> <span class="st0">"'favorite_color' =&gt; 'lavender'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found relation: person<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Missing relation: person<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"kid-&gt;Find('children.id=1' ... ADODB_WORK_AR) [Worker Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"Where we see that kid shares relationships with child because they are stored<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"in the common table's metadata structure.<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$ch3</span> <span class="sy0">=</span> <span class="kw2">new</span> Kid<span class="br0">(</span><span class="st_h">'children'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ach3</span> <span class="sy0">=</span> <span class="re0">$ch3</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st_h">'children.id=1'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'loading'</span> <span class="sy0">=&gt;</span> ADODB_WORK_AR<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach3</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'Jill'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found Jill<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach3</span><span class="sy0">,</span> <span class="st0">"'favorite_color' =&gt; 'lavender'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found relation: person<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Missing relation: person<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"kid-&gt;Find('children.id=1' ... ADODB_LAZY_AR) [Lazy Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"Of course, lazy loading also retrieve medata information...<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$ch32</span> <span class="sy0">=</span> <span class="kw2">new</span> Kid<span class="br0">(</span><span class="st_h">'children'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ach32</span> <span class="sy0">=</span> <span class="re0">$ch32</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st_h">'children.id=1'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'loading'</span> <span class="sy0">=&gt;</span> ADODB_LAZY_AR<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach32</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'Jill'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found Jill<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach32</span><span class="sy0">,</span> <span class="st0">"'favorite_color' =&gt; 'lavender'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[!!] Found relation when I shouldn't<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[OK] No relation yet<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$ach32</span> <span class="kw1">as</span> <span class="re0">$akid</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">if</span><span class="br0">(</span><span class="re0">$akid</span><span class="sy0">-&gt;</span><span class="me1">person</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach32</span><span class="sy0">,</span> <span class="st0">"'favorite_color' =&gt; 'lavender'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found relation: person<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Missing relation: person<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"rugrat-&gt;Find('children.id=1' ... ADODB_WORK_AR) [Worker Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"In rugrat's constructor it is specified that<span class="es1">\n</span>it must forget any existing relation<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$ch4</span> <span class="sy0">=</span> <span class="kw2">new</span> Rugrat<span class="br0">(</span><span class="st_h">'children'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ach4</span> <span class="sy0">=</span> <span class="re0">$ch4</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st_h">'children.id=1'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'loading'</span> <span class="sy0">=&gt;</span> ADODB_WORK_AR<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach4</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'Jill'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found Jill<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach4</span><span class="sy0">,</span> <span class="st0">"'favorite_color' =&gt; 'lavender'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[!!] Found relation when I shouldn't<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[OK] No relation found<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"kid-&gt;Find('children.id=1' ... ADODB_WORK_AR) [Worker Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"Note how only rugrat forgot its relations - kid is fine.<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$ch5</span> <span class="sy0">=</span> <span class="kw2">new</span> Kid<span class="br0">(</span><span class="st_h">'children'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ach5</span> <span class="sy0">=</span> <span class="re0">$ch5</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st_h">'children.id=1'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'loading'</span> <span class="sy0">=&gt;</span> ADODB_WORK_AR<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach5</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'Jill'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found Jill<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach5</span><span class="sy0">,</span> <span class="st0">"'favorite_color' =&gt; 'lavender'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] I did not forget relation: person<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] I should not have forgotten relation: person<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"rugrat-&gt;Find('children.id=1' ... ADODB_WORK_AR) [Worker Method]<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$ch6</span> <span class="sy0">=</span> <span class="kw2">new</span> Rugrat<span class="br0">(</span><span class="st_h">'children'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ch6s</span> <span class="sy0">=</span> <span class="re0">$ch6</span><span class="sy0">-&gt;</span><span class="me1">Find</span><span class="br0">(</span><span class="st_h">'children.id=1'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'loading'</span> <span class="sy0">=&gt;</span> ADODB_WORK_AR<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ach6</span> <span class="sy0">=</span> <span class="re0">$ch6s</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach6</span><span class="sy0">,</span> <span class="st0">"'name_first' =&gt; 'Jill'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found Jill<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Find failed<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach6</span><span class="sy0">,</span> <span class="st0">"'favorite_color' =&gt; 'lavender'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[!!] Found relation when I shouldn't<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[OK] No relation yet<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span>Loading relations:<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="re0">$ach6</span><span class="sy0">-&gt;</span><span class="me1">belongsTo</span><span class="br0">(</span><span class="st_h">'person'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ach6</span><span class="sy0">-&gt;</span><span class="me1">LoadRelations</span><span class="br0">(</span><span class="st_h">'person'</span><span class="sy0">,</span> <span class="st_h">'order by id'</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">2</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="br0">(</span>ar_assert<span class="br0">(</span><span class="re0">$ach6</span><span class="sy0">,</span> <span class="st0">"'favorite_color' =&gt; 'lavender'"</span><span class="br0">)</span><span class="br0">)</span> ? <span class="st0">"[OK] Found relation: person<span class="es1">\n</span>"</span> <span class="sy0">:</span> <span class="st0">"[!!] Missing relation: person<span class="es1">\n</span>"</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">echo</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"Test suite complete.<span class="es1">\n</span>"</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="st0">"---------------------------------------------------------------------------<span class="es1">\n</span>"</span><span class="sy0">;</span></pre>

</div>

<h1 class="sectionedit39" id="todo_code_contributions_welcome">Todo (Code Contributions welcome)</h1>
<div class="level1">

<p>
Check _original and current field values before update, only update changes. Also if the primary key value is changed, then on update, we should save and use the original primary key values in the WHERE clause!
</p>

<p>
PHP5 specific: Make GetActiveRecords*() return an Iterator.
</p>

<p>
PHP5 specific: Change PHP5 implementation of Active Record to use 
</p>
<pre class="code php">__get<span class="br0">(</span><span class="br0">)</span> and __set<span class="br0">(</span><span class="br0">)</span></pre>

<p>
 for better performance.
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>v5/userguide/active_record.txt</bdi> &middot; Last modified: 2019/05/08 16:32 by <bdi>dregad</bdi></div>

                
                <hr class="a11y">
            </div></main><!-- /content -->

            <!-- PAGE ACTIONS -->
            <nav id="dokuwiki__pagetools" aria-labelledby="dokuwiki__pagetools__heading">
                <h3 class="a11y" id="dokuwiki__pagetools__heading">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li class="source"><a href="active_record.html" title="Show pagesource [v]" rel="nofollow" accesskey="v"><span>Show pagesource</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path d="M13 9h5.5L13 3.5V9M6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m.12 13.5l3.74 3.74 1.42-1.41-2.33-2.33 2.33-2.33-1.42-1.41-3.74 3.74m11.16 0l-3.74-3.74-1.42 1.41 2.33 2.33-2.33 2.33 1.42 1.41 3.74-3.74z"></path></svg></a></li><li class="revs"><a href="active_record.html" title="Old revisions [o]" rel="nofollow" accesskey="o"><span>Old revisions</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path d="M11 7v5.11l4.71 2.79.79-1.28-4-2.37V7m0-5C8.97 2 5.91 3.92 4.27 6.77L2 4.5V11h6.5L5.75 8.25C6.96 5.73 9.5 4 12.5 4a7.5 7.5 0 0 1 7.5 7.5 7.5 7.5 0 0 1-7.5 7.5c-3.27 0-6.03-2.09-7.06-5h-2.1c1.1 4.03 4.77 7 9.16 7 5.24 0 9.5-4.25 9.5-9.5A9.5 9.5 0 0 0 12.5 2z"></path></svg></a></li><li class="backlink"><a href="active_record.html" title="Backlinks" rel="nofollow"><span>Backlinks</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path d="M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24m2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"></path></svg></a></li><li class="siteexport_addpage"><a href="active_record.html" title="Export Page to HTML/PDF" rel="nofollow"><span>Export Page to HTML/PDF</span><svg width="61px" height="51px" viewbox="0 0 61 51" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs></defs><path d="M26.1891503,39.0065635 L26.0876578,38.9773206 L60.6523866,1.23972885 L60.4321374,2.11844376 L60.476442,2.07071678 L60.4265202,2.14085429 L49.5024876,45.7237994 L32.8255882,40.9187101 L26,50.508302 L26,39.2103249 L26.1891503,39.0065635 Z M60.9727675,0.862917243 L22.2676619,38.2155059 L-0.00245042233,30.2214566 L60.9727675,0.862917243 Z" id="Paper-Plane"></path></svg></a></li><li class="top"><a href="#dokuwiki__top" title="Back to top [t]" rel="nofollow" accesskey="t"><span>Back to top</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg></a></li>                    </ul>
                </div>
            </nav>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<footer id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" rel="license" class="urlextern" target="_blank">CC Attribution-Share Alike 4.0 International</a></bdi></div>
    <div class="buttons">
        <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" rel="license" target="_blank"><img src="../../lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 4.0 International"></a>        <a href="https://www.dokuwiki.org/donate" title="Donate" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-donate.gif" width="80" height="15" alt="Donate"></a>
        <a href="https://php.net" title="Powered by PHP" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-php.gif" width="80" height="15" alt="Powered by PHP"></a>
        <a href="../../check/referer" title="Valid HTML5" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-html5.png" width="80" height="15" alt="Valid HTML5"></a>
        <a href="../../css-validator/check/referer.profile.css3?profile=css3" title="Valid CSS" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-css.png" width="80" height="15" alt="Valid CSS"></a>
        <a href="https://dokuwiki.org/" title="Driven by DokuWiki" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki"></a>
    </div>

    </div></footer><!-- /footer -->
    </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/taskrunner.1688205700.gif?1688205700" width="2" height="1" alt=""></div>
    <div id="screen__mode" class="no"></div></body>
</html>
