<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki">
<meta name="theme-color" content="#008800">
<meta name="robots" content="index,follow">
<meta name="keywords" content="v5,session,session_index">
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.html" title="ADOdb">
<link rel="start" href="session_index.html">
<link rel="contents" href="session_index.html" title="Sitemap">
<link rel="manifest" href="../../lib/exe/manifest.html">
<link rel="alternate" type="application/rss+xml" title="Recent Changes">
<link rel="alternate" type="application/rss+xml" title="Current namespace">
<link rel="alternate" type="text/html" title="Plain HTML" href="session_index.html">
<link rel="alternate" type="text/plain" title="Wiki Markup" href="session_index.html">
<link rel="canonical" href="https://adodb.org/dokuwiki/doku.php?id=v5:session:session_index">
<link rel="stylesheet" href="../../lib/exe/css.php.t.dokuwiki.css">
<!--[if gte IE 9]><!-->
<script>/*<![CDATA[*/var NS='v5:session';var JSINFO = {"plugins":{"edittable":{"default columnwidth":""}},"move_renameokay":false,"id":"v5:session:session_index","namespace":"v5:session","ACT":"show","useHeadingNavigation":1,"useHeadingContent":1};
/*!]]>*/</script>
<script src="../../lib/exe/jquery.php.t.dokuwiki.js" defer>/*<![CDATA[*/
/*!]]>*/</script>
<script src="../../lib/exe/js.php.t.dokuwiki.js" defer>/*<![CDATA[*/
/*!]]>*/</script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="shortcut icon" href="../../lib/tpl/dokuwiki/images/favicon.ico">
<link rel="apple-touch-icon" href="../../lib/tpl/dokuwiki/images/apple-touch-icon.png">
    <title>v5:session:session_index</title></head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki    showSidebar hasSidebar">

        
<!-- ********** HEADER ********** -->
<header id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1 class="logo"><a href="../..//index.html" accesskey="h" title="Home [h]"><img src="../../logo.png" width="176" height="62" alt=""> <span>ADOdb</span></a></h1>
                    <p class="claim">Database Abstraction Layer for PHP</p>
            </div>

    

    <!-- BREADCRUMBS -->
            
    
    <hr class="a11y">
<div style="text-align:right"><a href="https://adodb.org">ADOdb Web Site</a></div></div></header><!-- /header -->

        <div class="wrapper group">

                            <!-- ********** ASIDE ********** -->
                <nav id="dokuwiki__aside" aria-label="Sidebar"><div class="pad aside include group">
                    <h3 class="toggle">Sidebar</h3>
                    <div class="content"><div class="group">
                                                                        
<p>
<strong>Resources</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="../../v5/reference/reference_index.html" class="wikilink1" title="v5:reference:reference_index" data-wiki-id="v5:reference:reference_index">Reference Manual</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/userguide/userguide_index.html" class="wikilink1" title="v5:userguide:userguide_index" data-wiki-id="v5:userguide:userguide_index">User Guide &amp; Tutorials</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/dictionary/dictionary_index.html" class="wikilink1" title="v5:dictionary:dictionary_index" data-wiki-id="v5:dictionary:dictionary_index">The Data Dictionary</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/axmls/axmls_index.html" class="wikilink1" title="v5:axmls:axmls_index" data-wiki-id="v5:axmls:axmls_index">ADOdb-xmlschema</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/activerecord/activerecord_index.html" class="wikilink1" title="v5:activerecord:activerecord_index" data-wiki-id="v5:activerecord:activerecord_index">ADOdb Active Record</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/performance/performance_index.html" class="wikilink1" title="v5:performance:performance_index" data-wiki-id="v5:performance:performance_index">Performance Monitoring</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/datetime/datetime_index.html" class="wikilink1" title="v5:datetime:datetime_index" data-wiki-id="v5:datetime:datetime_index">Date/Time Library</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/session/session_index.html" class="wikilink1" title="v5:session:session_index" data-wiki-id="v5:session:session_index">Session Management Library</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/proxy/proxy_index.html" class="wikilink1" title="v5:proxy:proxy_index" data-wiki-id="v5:proxy:proxy_index">ADOdb Proxy Server</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/addons/addons_index.html" class="wikilink1" title="v5:addons:addons_index" data-wiki-id="v5:addons:addons_index">Unsupported Addons</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../project/standards.html" class="wikilink1" title="project:standards" data-wiki-id="project:standards">Coding Standards</a></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/php_compatibility_status.html" class="wikilink1" title="v5:php_compatibility_status" data-wiki-id="v5:php_compatibility_status">PHP Compatibility Status</a></div>
</li>
</ul>

<p>
<strong><a href="../../v5/database/supported.html" class="wikilink1" title="v5:database:supported" data-wiki-id="v5:database:supported">Supported Databases</a></strong>
</p>
<ol>
<li class="level1"><div class="li"> Full support    <ul><li><a href="../../v5/database/ibm_db2.html" class="wikilink1" title="v5:database:ibm_db2">IBM DB2</a></li><li><a href="../../v5/database/microsoft_sql_server.html" class="wikilink1" title="v5:database:microsoft_sql_server">Microsoft SQL Server</a></li><li><a href="../../v5/database/mysql.html" class="wikilink1" title="v5:database:mysql">MySQL</a></li><li><a href="../../v5/database/oracle.html" class="wikilink1" title="v5:database:oracle">Oracle</a></li><li><a href="../../v5/database/postgresql.html" class="wikilink1" title="v5:database:postgresql">PostgreSQL</a></li><li><a href="../../v5/database/sqlite.html" class="wikilink1" title="v5:database:sqlite">SQLite Database</a></li></ul></div>
</li>
<li class="level1"><div class="li"> Partial support <ul><li><a href="../../v5/database/firebird.html" class="wikilink1" title="v5:database:firebird">Firebird &amp; Interbase</a></li><li><a href="../../v5/database/ldap.html" class="wikilink1" title="v5:database:ldap">LDAP</a></li><li><a href="../../v5/database/access.html" class="wikilink1" title="v5:database:access">Microsoft Access</a></li><li><a href="../../v5/database/odbc.html" class="wikilink1" title="v5:database:odbc">ODBC</a></li><li><a href="../../v5/database/pdo.html" class="wikilink1" title="v5:database:pdo">PDO</a></li><li><a href="../../v5/database/pdo_new.html" class="wikilink1" title="v5:database:pdo_new">PDO (new)</a></li></ul></div>
</li>
<li class="level1"><div class="li"> <a href="../../v5/database/unsupported.html" class="wikilink1" title="v5:database:unsupported" data-wiki-id="v5:database:unsupported">Obsolete/Unsupported Drivers</a></div>
</li>
</ol>
                                            </div></div>
                </div></nav><!-- /aside -->
            
            <!-- ********** CONTENT ********** -->
            <main id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>v5:session:session_index</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#introduction">Introduction</a></div></li>
<li class="level1"><div class="li"><a href="#driver_support">Driver Support</a></div></li>
<li class="level1"><div class="li"><a href="#usage">Usage</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#overriding_table_name_defaults">Overriding Table Name Defaults</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#adodb_session_handler_features">ADOdb Session Handler Features</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#session_handler_files">Session Handler Files</a></div></li>
<li class="level2"><div class="li"><a href="#usage_examples">Usage Examples</a></div></li>
<li class="level2"><div class="li"><a href="#dsn_support">DSN Support</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#using_encrypted_sessions">Using Encrypted Sessions</a></div></li>
<li class="level1"><div class="li"><a href="#installation">Installation</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#mysql_or_pdo_mysql">MySQL or PDO MySQL</a></div></li>
<li class="level2"><div class="li"><a href="#postgresql">PostgreSQL</a></div></li>
<li class="level2"><div class="li"><a href="#oracle">Oracle</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#notifications">Notifications</a></div></li>
<li class="level1"><div class="li"><a href="#neat_notification_tricks">Neat Notification Tricks</a></div></li>
<li class="level1"><div class="li"><a href="#compressionencryption_schemes">Compression/Encryption Schemes</a></div></li>
<li class="level1"><div class="li"><a href="#backwards_compatibility">Backwards Compatibility</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="session_management">Session Management</h1>
<div class="level1">
<div class="wrap_right wrap_box plugin_wrap">
<p>
<a href="../../v5/session/index.html" class="wikilink1" title="v5:session:index" data-wiki-id="v5:session:index">Session Management</a><br>

<a href="../../v5/session/reference/index.html" class="wikilink1" title="v5:session:reference:index" data-wiki-id="v5:session:reference:index">Session Command Reference</a><br>

</p>
</div>
</div>

<h2 class="sectionedit4" id="introduction">Introduction</h2>
<div class="level2">

<p>
ADOdb session management extends the standard functionality of PHP sessions, by allowing the normal session data seen to be stored in a database itself. There are numerous ways that this method enhances the default behavior
</p>
<ul>
<li class="level1"><div class="li"> Simplified clean-up at end of session life</div>
</li>
<li class="level1"><div class="li"> Easy analysis of session data</div>
</li>
<li class="level1"><div class="li"> Simple session termination</div>
</li>
<li class="level1"><div class="li"> <strong><em>Session data can be manipulated by external programs</em></strong></div>
</li>
<li class="level1"><div class="li"> Encryption of session data</div>
</li>
<li class="level1"><div class="li"> Allows implementation of session termination callbacks</div>
</li>
<li class="level1"><div class="li"> Session data can be retained if used across with load balancing servers</div>
</li>
</ul>

<p>
ADOdb session management can be considered an extension of the normal behavior. It uses the same command syntax and structure as normal sessions, and honors the values defined in php.ini for sessions. 
</p>

<p>
These records will be garbage collected based on the php.ini [session] timeout settings. You can register a notification function to notify you when the record has expired and is about to be freed by the garbage collector.
</p>

<p>
An alternative to using a database backed session handler is to use <a href="../../v5/userguide/memcached.html" class="wikilink1" title="v5:userguide:memcached" data-wiki-id="v5:userguide:memcached">Memcached Setup</a>. This is a distributed memory based caching system suitable for storing session information.
</p>
<div class="wrap_important plugin_wrap">
<p>
The original session management routines that use <code>adodb-session.inc.php</code> are deprecated as of ADOdb version 5.20, and will be removed in ADOdb Version 6.0.0. For information on upgrading from the original version, see <a href="../../v5/session/version1.html" class="wikilink1" title="v5:session:version1" data-wiki-id="v5:session:version1">Here</a>
</p>
</div>
</div>

<h2 class="sectionedit7" id="driver_support">Driver Support</h2>
<div class="level2">

<p>
The following drivers are known to work with the adodb-session2.php file:
</p>
<ol>
<li class="level1"><div class="li"> mysqli</div>
</li>
<li class="level1"><div class="li"> pdo_mysqli (From ADOdb version 5.21)</div>
</li>
<li class="level1"><div class="li"> postgres</div>
</li>
<li class="level1"><div class="li"> oci8</div>
</li>
</ol>

<p>
This is not an exhaustive list, if you are using the system with a different database, let us know so we can add it to the list.
</p>

</div>

<h2 class="sectionedit8" id="usage">Usage</h2>
<div class="level2">
<pre class="code php"><span class="kw1">include_once</span> <span class="st0">"adodb/session/adodb-session2.php"</span><span class="sy0">;</span>
ADOdb_Session<span class="sy0">::</span><span class="me2">config</span><span class="br0">(</span><span class="re0">$driver</span><span class="sy0">,</span> <span class="re0">$host</span><span class="sy0">,</span> <span class="re0">$user</span><span class="sy0">,</span> <span class="re0">$password</span><span class="sy0">,</span> <span class="re0">$database</span><span class="sy0">,</span><span class="re0">$options</span><span class="sy0">=</span><span class="kw4">false</span><span class="br0">)</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/session_start"><span class="kw3">session_start</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="coMULTI">/*
* Test session vars, the following should increment on refresh
*/</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span><a target="_blank" href="http://www.php.net/isset"><span class="kw3">isset</span></a><span class="br0">(</span><span class="re0">$_SESSION</span><span class="br0">[</span><span class="st_h">'AVAR'</span><span class="br0">]</span><span class="br0">)</span><span class="br0">)</span>
    <span class="re0">$_SESSION</span><span class="br0">[</span><span class="st_h">'AVAR'</span><span class="br0">]</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$_SESSION</span><span class="br0">[</span><span class="st_h">'AVAR'</span><span class="br0">]</span> <span class="sy0">+=</span> <span class="nu0">1</span><span class="sy0">;</span>
<span class="kw1">print</span> <span class="st0">"&lt;p&gt;<span class="es1">\$</span>_SESSION['AVAR']=<span class="es4">{$_SESSION['AVAR']}</span>&lt;/p&gt;"</span><span class="sy0">;</span></pre>

<p>
When the session is created in session_start( ), the global variable <code>$ADODB_SESS_CONN</code> holds the connection object.
</p>

<p>
The default name of the table is <strong>sessions2</strong>.
</p>

</div>

<h3 class="sectionedit9" id="overriding_table_name_defaults">Overriding Table Name Defaults</h3>
<div class="level3">
<pre class="code php"><span class="kw1">include_once</span> <span class="st0">"adodb/session/adodb-session2.php"</span><span class="sy0">;</span>
<span class="re0">$options</span><span class="br0">[</span><span class="st_h">'table'</span><span class="br0">]</span> <span class="sy0">=</span> <span class="st_h">'mytablename'</span><span class="sy0">;</span>
ADOdb_Session<span class="sy0">::</span><span class="me2">config</span><span class="br0">(</span><span class="re0">$driver</span><span class="sy0">,</span> <span class="re0">$host</span><span class="sy0">,</span> <span class="re0">$user</span><span class="sy0">,</span> <span class="re0">$password</span><span class="sy0">,</span> <span class="re0">$database</span><span class="sy0">,</span><span class="re0">$options</span><span class="br0">)</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/session_start"><span class="kw3">session_start</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit10" id="adodb_session_handler_features">ADOdb Session Handler Features</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Ability to define a notification function that is called when a session expires. Typically used to detect session logout and release global resources.</div>
</li>
<li class="level1"><div class="li"> Optimization of database writes. We crc32 the session data and only perform an update to the session data if there is a data change.</div>
</li>
<li class="level1"><div class="li"> Support for large amounts of session data with CLOBs (see adodb-session-clob2.php). Useful for Oracle.</div>
</li>
<li class="level1"><div class="li"> Support for encrypted session data, see adodb-cryptsession2.php. Enabling encryption is simply a matter of including adodb-cryptsession2.php instead of adodb-session2.php.</div>
</li>
</ul>

</div>

<h3 class="sectionedit11" id="session_handler_files">Session Handler Files</h3>
<div class="level3">

<p>
There are 3 session management files that you can use:
</p>
<pre class="code">adodb-session2.php        : The default
adodb-cryptsession2.php   : Use this if you want to store encrypted 
                            session data in the database
adodb-session-clob2.php   : Use this if you are storing DATA in clobs
                            and you are NOT using oci8 driver</pre>

</div>

<h3 class="sectionedit12" id="usage_examples">Usage Examples</h3>
<div class="level3">

<p>
To force non-persistent connections, call <code>persist()</code> first before <code>session_start()</code>:
</p>
<pre class="code php"><span class="kw1">include_once</span> <span class="st0">"adodb/session/adodb-session2.php"</span><span class="sy0">;</span>
<span class="re0">$driver</span>   <span class="sy0">=</span> <span class="st_h">'mysql'</span><span class="sy0">;</span> 
<span class="re0">$host</span>     <span class="sy0">=</span> <span class="st_h">'localhost'</span><span class="sy0">;</span> 
<span class="re0">$user</span>     <span class="sy0">=</span> <span class="st_h">'auser'</span><span class="sy0">;</span> 
<span class="re0">$pwd</span>      <span class="sy0">=</span> <span class="st_h">'secret'</span><span class="sy0">;</span> 
<span class="re0">$database</span> <span class="sy0">=</span> <span class="st_h">'sessiondb'</span><span class="sy0">;</span>
&nbsp;
ADOdb_Session<span class="sy0">::</span><span class="me2">config</span><span class="br0">(</span><span class="re0">$driver</span><span class="sy0">,</span> <span class="re0">$host</span><span class="sy0">,</span> <span class="re0">$user</span><span class="sy0">,</span> <span class="re0">$password</span><span class="sy0">,</span> <span class="re0">$database</span><span class="sy0">,</span> <span class="re0">$options</span><span class="sy0">=</span><span class="kw4">false</span><span class="br0">)</span><span class="sy0">;</span>
ADOdb_Session<span class="sy0">::</span><span class="me2">persist</span><span class="br0">(</span><span class="re0">$connectMode</span><span class="sy0">=</span><span class="kw4">false</span><span class="br0">)</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/session_start"><span class="kw3">session_start</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h3 class="sectionedit13" id="dsn_support">DSN Support</h3>
<div class="level3">

<p>
using DSN support so you can set other options such as port number:
</p>
<pre class="code php"><span class="kw1">include_once</span> <span class="st0">"adodb/session/adodb-session2.php"</span><span class="sy0">;</span>
<span class="re0">$dsn</span> <span class="sy0">=</span> <span class="st_h">'mysql://root:pwd@localhost/mydb?persist=1&amp;port=5654'</span><span class="sy0">;</span>
ADOdb_Session<span class="sy0">::</span><span class="me2">config</span><span class="br0">(</span><span class="re0">$dsn</span><span class="sy0">,</span> <span class="st_h">''</span><span class="sy0">,</span> <span class="st_h">''</span><span class="sy0">,</span> <span class="st_h">''</span><span class="br0">)</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/session_start"><span class="kw3">session_start</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit14" id="using_encrypted_sessions">Using Encrypted Sessions</h2>
<div class="level2">

<p>
To use a encrypted sessions, replace the file <code>adodb-session2.php</code> with <code>adodb-cryptsession2.php</code>:
</p>
<pre class="code php"><span class="kw1">include</span> <span class="st_h">'adodb/session/adodb-cryptsession2.php'</span><span class="sy0">;</span>
<span class="re0">$driver</span> <span class="sy0">=</span> <span class="st_h">'mysql'</span><span class="sy0">;</span> 
<span class="re0">$host</span> <span class="sy0">=</span> <span class="st_h">'localhost'</span><span class="sy0">;</span>
<span class="re0">$user</span> <span class="sy0">=</span> <span class="st_h">'auser'</span><span class="sy0">;</span> 
<span class="re0">$pwd</span> <span class="sy0">=</span> <span class="st_h">'secret'</span><span class="sy0">;</span> 
<span class="re0">$database</span> <span class="sy0">=</span> <span class="st_h">'sessiondb'</span><span class="sy0">;</span>
&nbsp;
ADOdb_Session<span class="sy0">::</span><span class="me2">config</span><span class="br0">(</span><span class="re0">$driver</span><span class="sy0">,</span> <span class="re0">$host</span><span class="sy0">,</span> <span class="re0">$user</span><span class="sy0">,</span> <span class="re0">$password</span><span class="sy0">,</span> <span class="re0">$database</span><span class="sy0">,</span><span class="re0">$options</span><span class="sy0">=</span><span class="kw4">false</span><span class="br0">)</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/session_start"><span class="kw3">session_start</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
And the same technique for adodb-session-clob2.php:
</p>
<pre class="code php"><span class="kw1">include</span> <span class="st_h">'adodb/session/adodb-session2-clob2.php'</span><span class="sy0">;</span>
<span class="re0">$driver</span> <span class="sy0">=</span> <span class="st_h">'oci8'</span><span class="sy0">;</span> 
<span class="re0">$host</span> <span class="sy0">=</span> <span class="st_h">'localhost'</span><span class="sy0">;</span>
<span class="re0">$user</span> <span class="sy0">=</span> <span class="st_h">'auser'</span><span class="sy0">;</span> 
<span class="re0">$pwd</span> <span class="sy0">=</span> <span class="st_h">'secret'</span><span class="sy0">;</span> 
<span class="re0">$database</span> <span class="sy0">=</span> <span class="st_h">'sessiondb'</span><span class="sy0">;</span>
&nbsp;
ADOdb_Session<span class="sy0">::</span><span class="me2">config</span><span class="br0">(</span><span class="re0">$driver</span><span class="sy0">,</span> <span class="re0">$host</span><span class="sy0">,</span> <span class="re0">$user</span><span class="sy0">,</span> <span class="re0">$password</span><span class="sy0">,</span> <span class="re0">$database</span><span class="sy0">,</span><span class="re0">$options</span><span class="sy0">=</span><span class="kw4">false</span><span class="br0">)</span><span class="sy0">;</span>
<a target="_blank" href="http://www.php.net/session_start"><span class="kw3">session_start</span></a><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>

</div>

<h2 class="sectionedit15" id="installation">Installation</h2>
<div class="level2">

<p>
Create this table in your database. 
</p>

</div>

<h3 class="sectionedit16" id="mysql_or_pdo_mysql">MySQL or PDO MySQL</h3>
<div class="level3">
<pre class="code">CREATE TABLE sessions2 (
  sesskey VARCHAR( 64 ) COLLATE utf8mb4_bin NOT NULL DEFAULT '',
  expiry DATETIME NOT NULL ,
  expireref VARCHAR( 250 ) DEFAULT '',
  created DATETIME NOT NULL ,
  modified DATETIME NOT NULL ,
  sessdata LONGTEXT,
  PRIMARY KEY ( sesskey ) ,
  INDEX sess2_expiry( expiry ),
  INDEX sess2_expireref( expireref )
)</pre>
<div class="wrap_info plugin_wrap">
<p>
When <a href="https://www.php.net/manual/en/session.configuration.php#ini.session.sid-bits-per-character" class="urlextern" target="_blank" title="https://www.php.net/manual/en/session.configuration.php#ini.session.sid-bits-per-character" rel="ugc nofollow noopener">session.sid_bits_per_character</a> php.ini setting is set to 6, the <em>Session ID</em> can contain both upper and lowercase letters. 
Collisions could occur in this case, due to MySQL performing case-insensitive searches by default. 
To avoid that, the <em>sesskey</em> column should use binary (or a case-sensitive) collation.
</p>
</div>
</div>

<h3 class="sectionedit19" id="postgresql">PostgreSQL</h3>
<div class="level3">
<pre class="code">CREATE TABLE sessions2(
 sesskey VARCHAR( 64 ) NOT NULL DEFAULT '',
 expiry TIMESTAMP NOT NULL ,
 expireref VARCHAR( 250 ) DEFAULT '',
 created TIMESTAMP NOT NULL ,
 modified TIMESTAMP NOT NULL ,
 sessdata TEXT DEFAULT '',
 PRIMARY KEY ( sesskey )
 );

create INDEX sess2_expiry on sessions2( expiry );
create INDEX sess2_expireref on sessions2 ( expireref );</pre>

</div>

<h3 class="sectionedit20" id="oracle">Oracle</h3>
<div class="level3">

<p>
This definition uses a CLOB for the SESSDATA field:
</p>
<pre class="code">  CREATE TABLE SESSIONS2
(
   SESSKEY    VARCHAR2(48 BYTE)                  NOT NULL,
   EXPIRY     DATE                               NOT NULL,
   EXPIREREF  VARCHAR2(200 BYTE),
   CREATED    DATE                               NOT NULL,
   MODIFIED   DATE                               NOT NULL,
   SESSDATA   CLOB,
  PRIMARY KEY(SESSKEY)
);</pre>
<pre class="code">CREATE INDEX SESS2_EXPIRY ON SESSIONS2(EXPIRY);
CREATE INDEX SESS2_EXPIREREF ON SESSIONS2(EXPIREREF);</pre>

<p>
We need to use a CLOB here because for text greater than 4000 bytes long, Oracle requires you to use the CLOB data type. If you are using the oci8 driver, ADOdb will automatically enable CLOB handling. So you can use either <code>adodb-session2.php</code> or <code>adodb-session-clob2.php</code> - in this case it doesn't matter. 
</p>

</div>

<h2 class="sectionedit21" id="notifications">Notifications</h2>
<div class="level2">

<p>
You can receive notification when your session is cleaned up by the session garbage collector or when you call <em>session_destroy()</em>.
</p>

<p>
PHP's session extension will automatically run a special garbage collection function based on your php.ini session.cookie_lifetime and session.gc_probability settings. This will in turn call ADOdb's garbage collection function, which can be setup to perform notification.
</p>
<pre class="code">PHP Session --&gt; ADOdb Session --&gt; Find all recs --&gt; Send         --&gt; Delete
GC Function     GC Function       to be deleted     notification     queued
executed at     called by                           for all recs     records
random time     Session                             queued for
                Extension                           deletion</pre>

<p>
When a session is created, we need to store a value in the session record (in the EXPIREREF field), typically the userid of the session. Later when the session has expired, just before the record is deleted, we reload the EXPIREREF field and call the notification function with the value of EXPIREREF, which is the userid of the person being logged off.
</p>

<p>
ADOdb uses a global variable $ADODB_SESSION_EXPIRE_NOTIFY that you must predefine before session start to store the notification configuration. $ADODB_SESSION_EXPIRE_NOTIFY is an array with 2 elements, the first being the name of the session variable you would like to store in the EXPIREREF field, and the 2nd is the notification function's name.
</p>

<p>
For example, suppose we want to be notified when a user's session has expired, based on the userid. When the user logs in, we store the id in the global session variable $USERID. The function name is <code>NotifyFn</code>.
</p>

<p>
So we define (before session_start() is called):
</p>
<pre class="code php"><span class="re0">$ADODB_SESSION_EXPIRE_NOTIFY</span> <span class="sy0">=</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'USERID'</span><span class="sy0">,</span><span class="st_h">'NotifyFn'</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
And when the NotifyFn is called (when the session expires), the <code>$EXPIREREF</code> holding the user id is passed in as the first parameter, e.g. <code>NotifyFn($userid, $sesskey)</code>. The session key (which is the primary key of the record in the sessions table) is the 2nd parameter.
</p>

<p>
Here is an example of a Notification function that deletes some records in the database and temporary files:
</p>
<pre class="code php"><span class="kw2">function</span> NotifyFn<span class="br0">(</span><span class="re0">$expireref</span><span class="sy0">,</span> <span class="re0">$sesskey</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">global</span> <span class="re0">$ADODB_SESS_CONN</span><span class="sy0">;</span> <span class="co2"># the session connection object
</span>	<span class="re0">$user</span> <span class="sy0">=</span> <span class="re0">$ADODB_SESS_CONN</span><span class="sy0">-&gt;</span><span class="me1">qstr</span><span class="br0">(</span><span class="re0">$expireref</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
	<span class="re0">$ADODB_SESS_CONN</span><span class="sy0">-&gt;</span><span class="me1">execute</span><span class="br0">(</span><span class="st0">"delete from shopping_cart where user=<span class="es4">$user</span>"</span><span class="br0">)</span><span class="sy0">;</span>
	<a target="_blank" href="http://www.php.net/system"><span class="kw3">system</span></a><span class="br0">(</span><span class="st0">"rm /work/tmpfiles/<span class="es4">$expireref</span>/*"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>
<div class="wrap_info plugin_wrap">
<p>
EXPIREREF must be set manually, e.g. 
</p>
<pre class="code php"><span class="re0">$GLOBALS</span><span class="br0">[</span><span class="st_h">'USERID'</span><span class="br0">]</span> <span class="sy0">=</span> GetUserID<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$ADODB_SESSION_EXPIRE_NOTIFY</span> <span class="sy0">=</span> <a target="_blank" href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st_h">'USERID'</span><span class="sy0">,</span><span class="st_h">'NotifyFn'</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
In older versions of ADOdb this could be achieved automatically through the use of register_globals, but this feature has been <a href="https://php-legacy-docs.zend.com/manual/php5/en/security.globals" class="urlextern" target="_blank" title="https://php-legacy-docs.zend.com/manual/php5/en/security.globals" rel="ugc nofollow noopener">removed in PHP 5.4 for security reasons</a>.
</p>
</div><div class="wrap_info plugin_wrap">
<p>
If you want to change the EXPIREREF after the session record has been created, you will need to modify any session variable to force a database record update.
</p>
</div>
</div>

<h2 class="sectionedit26" id="neat_notification_tricks">Neat Notification Tricks</h2>
<div class="level2">

<p>
<strong>ExpireRef</strong> normally holds the user id of the current session.
</p>
<ol>
<li class="level1"><div class="li"> You can then write a session monitor, scanning expireref to see who is currently logged on.</div>
</li>
<li class="level1"><div class="li"> If you delete the sessions record for a specific user, eg. <code>delete from sessions where expireref = '$USER</code>' then the user is logged out. Useful for ejecting someone from a site.</div>
</li>
<li class="level1"><div class="li"> You can scan the sessions table to ensure no user can be logged in twice. Useful for security reasons.</div>
</li>
</ol>

</div>

<h2 class="sectionedit27" id="compressionencryption_schemes">Compression/Encryption Schemes</h2>
<div class="level2">

<p>
Multiple encryption and compression schemes are supported. Currently, supported are:
</p>
<ul>
<li class="level1"><div class="li"> MD5Crypt (crypt.inc.php)</div>
</li>
<li class="level1"><div class="li"> MCrypt</div>
</li>
<li class="level1"><div class="li"> Secure (Horde's emulation of MCrypt, if MCrypt module is not available.)</div>
</li>
<li class="level1"><div class="li"> GZip</div>
</li>
<li class="level1"><div class="li"> BZip2</div>
</li>
</ul>

<p>
These are stackable. E.g.
</p>
<pre class="code php">ADODB_Session<span class="sy0">::</span><span class="me2">filter</span><span class="br0">(</span><span class="kw2">new</span> ADODB_Compress_Bzip2<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
ADODB_Session<span class="sy0">::</span><span class="me2">filter</span><span class="br0">(</span><span class="kw2">new</span> ADODB_Encrypt_MD5<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>

<p>
will compress and then encrypt the record in the database.
</p>

</div>

<h2 class="sectionedit28" id="backwards_compatibility">Backwards Compatibility</h2>
<div class="level2">

<p>
The older method of connecting to ADOdb using global variables is now deprecated, and <strong>will be removed</strong> in ADOdb version 6.0:
</p>
<pre class="code php"><span class="re0">$ADODB_SESSION_DRIVER</span><span class="sy0">=</span><span class="st_h">'mysql'</span><span class="sy0">;</span>
<span class="re0">$ADODB_SESSION_CONNECT</span><span class="sy0">=</span><span class="st_h">'localhost'</span><span class="sy0">;</span>
<span class="re0">$ADODB_SESSION_USER</span> <span class="sy0">=</span><span class="st_h">'root'</span><span class="sy0">;</span>
<span class="re0">$ADODB_SESSION_PWD</span> <span class="sy0">=</span><span class="st_h">'abc'</span><span class="sy0">;</span>
<span class="re0">$ADODB_SESSION_DB</span> <span class="sy0">=</span><span class="st_h">'employees'</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">include</span> <span class="st_h">'adodb/adodb-session.php'</span><span class="sy0">;</span></pre>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>v5/session/session_index.txt</bdi> &middot; Last modified: 2023/04/08 18:08 by <bdi>dregad</bdi></div>

                
                <hr class="a11y">
            </div></main><!-- /content -->

            <!-- PAGE ACTIONS -->
            <nav id="dokuwiki__pagetools" aria-labelledby="dokuwiki__pagetools__heading">
                <h3 class="a11y" id="dokuwiki__pagetools__heading">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li class="source"><a href="session_index.html" title="Show pagesource [v]" rel="nofollow" accesskey="v"><span>Show pagesource</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path d="M13 9h5.5L13 3.5V9M6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m.12 13.5l3.74 3.74 1.42-1.41-2.33-2.33 2.33-2.33-1.42-1.41-3.74 3.74m11.16 0l-3.74-3.74-1.42 1.41 2.33 2.33-2.33 2.33 1.42 1.41 3.74-3.74z"></path></svg></a></li><li class="revs"><a href="session_index.html" title="Old revisions [o]" rel="nofollow" accesskey="o"><span>Old revisions</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path d="M11 7v5.11l4.71 2.79.79-1.28-4-2.37V7m0-5C8.97 2 5.91 3.92 4.27 6.77L2 4.5V11h6.5L5.75 8.25C6.96 5.73 9.5 4 12.5 4a7.5 7.5 0 0 1 7.5 7.5 7.5 7.5 0 0 1-7.5 7.5c-3.27 0-6.03-2.09-7.06-5h-2.1c1.1 4.03 4.77 7 9.16 7 5.24 0 9.5-4.25 9.5-9.5A9.5 9.5 0 0 0 12.5 2z"></path></svg></a></li><li class="backlink"><a href="session_index.html" title="Backlinks" rel="nofollow"><span>Backlinks</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path d="M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24m2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"></path></svg></a></li><li class="siteexport_addpage"><a href="session_index.html" title="Export Page to HTML/PDF" rel="nofollow"><span>Export Page to HTML/PDF</span><svg width="61px" height="51px" viewbox="0 0 61 51" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs></defs><path d="M26.1891503,39.0065635 L26.0876578,38.9773206 L60.6523866,1.23972885 L60.4321374,2.11844376 L60.476442,2.07071678 L60.4265202,2.14085429 L49.5024876,45.7237994 L32.8255882,40.9187101 L26,50.508302 L26,39.2103249 L26.1891503,39.0065635 Z M60.9727675,0.862917243 L22.2676619,38.2155059 L-0.00245042233,30.2214566 L60.9727675,0.862917243 Z" id="Paper-Plane"></path></svg></a></li><li class="top"><a href="#dokuwiki__top" title="Back to top [t]" rel="nofollow" accesskey="t"><span>Back to top</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg></a></li>                    </ul>
                </div>
            </nav>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<footer id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" rel="license" class="urlextern" target="_blank">CC Attribution-Share Alike 4.0 International</a></bdi></div>
    <div class="buttons">
        <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" rel="license" target="_blank"><img src="../../lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 4.0 International"></a>        <a href="https://www.dokuwiki.org/donate" title="Donate" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-donate.gif" width="80" height="15" alt="Donate"></a>
        <a href="https://php.net" title="Powered by PHP" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-php.gif" width="80" height="15" alt="Powered by PHP"></a>
        <a href="../../check/referer" title="Valid HTML5" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-html5.png" width="80" height="15" alt="Valid HTML5"></a>
        <a href="../../css-validator/check/referer.profile.css3?profile=css3" title="Valid CSS" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-css.png" width="80" height="15" alt="Valid CSS"></a>
        <a href="https://dokuwiki.org/" title="Driven by DokuWiki" target="_blank"><img src="../../lib/tpl/dokuwiki/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki"></a>
    </div>

    </div></footer><!-- /footer -->
    </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/taskrunner.1688205693.gif?1688205693" width="2" height="1" alt=""></div>
    <div id="screen__mode" class="no"></div></body>
</html>
